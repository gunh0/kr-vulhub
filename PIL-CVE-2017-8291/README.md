### 요약
GhostButt 취약점은 EPS 파일의 인터프리터인 GhostScript 프로그램에서 객체의 타입 체킹을 하지 않아 발생한다. 

EPS 파일이란, 어도비에서 개발한 프린터 출력 제어 언어인 PS(PostScript)로 작성된 파일로, 하나의 그래픽을 표현한다. 

EPS 파일 내부에 악성코드나 쉘을 실행할 수 있는 명령어를 심어두고 파일의 확장자만 png로 바꾼다면, GhostScript 프로그램이 이 파일이 정말 png 파일이 맞는지 확인하지 않고 실행하기 때문에 eps 파일과 내부에 있는 해커가 심어둔 코드까지 실행될 수 있는 것이다.

PIL은 파이썬에서 이미지를 처리하는 모듈이다. 이 모듈은 내부적으로 GhostScript를 이용한다. 그래서 GhostScript에서 발생할 수 있는 GhostButt vulnerability가 발생할 수 있다. 이 취약점은 remote code execution을 발생시킬 수 있다.

### 코드 설명
도커 컴포즈 프로젝트를 실행하고 난 후에는 http://your-ip:8000/ 에서 업로드 페이지에 접근할 수 있다. 

정상적으로 작동한다면, PNG 파일을 업로드하고 PIL을 사용하여 이미지를 로드하고 그 크기를 출력해야 한다. 

그러나 실행 가능한 EPS 파일의 확장자를 PNG로 변경하여 업로드하는 것이 가능하다. 
이는 고스트 스크립트에서 이미지 유형을 파일 헤더를 기반으로 결정하며 파일 확장자 검사를 무시하기 때문이다.

예를 들어, 악성 파일을 "poc.png"로 이름 바꾸고 업로드하면 "touch /tmp/aaaaa" 명령이 실행된다. 이 악성파일에서는 출력 파일을 처리하고 결과를 파일로 저장하는 부분에 (%pipe%touch /tmp/aaaaa)를 사용하여 명령 실행을 시도한다. 

POC에서 명령을 reverse shell 명령으로 수정하면 쉘을 딸 수 있다. 

### 실행 방법
```
docker compose up -d
```
위 명령어를 이용하여 테스트 환경을 실행하면 http://your-ip:8000/에서 이미지를 로드할 수 있다.
![vulhub1](https://github.com/vulhub/vulhub/assets/142128469/0708f3a3-f00b-4f01-b61c-326288fddecd)

### exploit 시도 후 실패
poc.png 파일에서 touch /tmp/aaaaa를 리버스 쉘 명령어(nc -lvnp [포트번호])로 바꾸어서 exploit을 시도했으나 실패했다.

원래라면 이렇게 리버스 쉘이 실행돼야 하지만
![01](https://github.com/vulhub/vulhub/assets/142128469/78045659-16e4-4b65-b3b9-4da4e4a6ecbd)
어쩐 일인지 내 pc에서는 이미지 사이즈가 0으로 출력된 후 리버스쉘이 실행되지 않는다.
![vulhub2](https://github.com/vulhub/vulhub/assets/142128469/5931abfc-be7b-4d6c-98d8-a6e6b76b0e63)

###참고
https://blog.naver.com/ledimoon/110081657669

https://asec.ahnlab.com/wp-content/uploads/tistory/1239_AhnLab_ASEC_%ED%95%9C%EA%B8%80%ED%8C%8C%EC%9D%BC%EC%97%90%EC%88%A8%EC%96%B4%EB%93%A0%EA%B3%A0%EC%8A%A4%ED%8A%B8.pdf


