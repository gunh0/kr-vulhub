# Langflow CVE-2025-3248 인증 우회 원격 코드 실행

화이트햇 스쿨 3기 27반_이윤희(4081)

---

# 1. 개요

Langflow는 에이전트 기반 AI 워크플로우를 시각적으로 구축할 수 있도록 지원하는 Python 기반 오픈소스 플랫폼입니다. 최근 Langflow에는 여러 보안 취약점이 보고된 바 있으나, CVE-2025-3248은 특히 심각한 영향을 미치는 취약점입니다.

CVE-2025-3248은 Langflow 1.3.0 미만 버전에서 발생하는 인증되지 않은 원격 코드 실행(RCE) 취약점입니다. 문제는 `/api/v1/validate/code` 엔드포인트가 사용자로부터 입력받은 Python 코드를 AST 파싱과정 없이 직접 `exec()` 함수로 실행하면서 발생합니다. 특히 Python 데코레이터나 기본 인수 표현식이 함수 정의 단계에서 바로 실행되기 때문에, 공격자가 악성 코드를 삽입할 수 있습니다.

---

# 2. 환경 구성

## 2.1 실습 환경

OS : Windows 11

사용 도구 : Docker Desktop, Burp Suite Community Edition

실습 대상 : Langflow 1.2.0 (vulhub 환경)


## 2.2 Docker 기반 Langflow 서버 구축

- docker-compose.yml
```yaml
services:
  web:
    image: vulhub/langflow:1.2.0
    ports:
      - 7860:7860
    environment:
      - LANGFLOW_HOST=0.0.0.0
      - LANGFLOW_AUTO_LOGIN=false
      - LANGFLOW_SUPERUSER=administrator
      - LANGFLOW_SUPERUSER_PASSWORD=vulhub
      - DO_NOT_TRACK=true
      - GIT_PYTHON_REFRESH=quiet
```

- Docker clone
```bash
git clone https://github.com/본인아이디/vulhub.git
cd vulhub/langflow/CVE-2025-3248
docker-compose up -d
```
![image](https://github.com/user-attachments/assets/f2fa7f16-24a1-46ea-8069-a4c8628e5d15)


- Langflow 서버 로그인
브라우저로 http://localhost:7860 접속하여 Langflow 서버에 로그인합니다. 
(ID: administrator / PW: vulhub)

---

# 3. PoC 재현

![Request Message](./Request%20Message.png)

Burp Suite의 Repeater 기능을 사용하여 악성 Python 함수를 `/api/v1/validate/code` 엔드포인트로 전송합니다.

전송한 요청은 Python의 데코레이터 문법을 악용하여, 함수 정의 과정에서 서버 내부에서 코드를 실행하도록 구성되어 있습니다. 페이로드는 `exec()` 함수를 이용해 Python 명령어를 삽입하고 있으며, 내부에서는 `raise Exception(...)` 구문을 통해 강제로 예외를 발생시키고, 그 과정에서 `subprocess.check_output(['id'])` 명령어를 실행하도록 설계되었습니다. 이로 인해 서버는 시스템 명령어인 `id`를 실행한 결과를 예외 메시지 형태로 반환하게 되며, 이를 통해 인증 없이 서버 내부 명령어 실행이 가능함을 입증할 수 있었습니다.

![Response Message](./Response%20Message.png)

요청 전송 결과, 서버는 uid=0(root) gid=0(root) 정보를 반환하며 명령어 실행이 성공한 것을 확인할 수 있었습니다.

---

# 4. 대응 방안

본 취약점에 대한 근본적인 대응은 다음과 같습니다.

- Langflow를 1.3.0 이상 최신 버전으로 즉시 업그레이드합니다.
- 외부 노출이 필요한 경우, Langflow 서버를 VPC로 격리하고, 접근 제어를 강화합니다.
- 인증되지 않은 엔드포인트에 대해 엄격한 접근 제어 및 코드 실행 차단 정책을 적용합니다.
- 코드 검증 시 `exec()` 대신 안전한 파싱 및 실행 방법을 적용합니다.

추가적으로, Langflow 같은 AI 에이전트 기반 시스템을 인터넷에 노출할 때는 항상 VPC 격리, 접근제어(SSO, VPN), 보안 감사 등을 적용하는 것을 권장합니다.

---

# 5. 참고 자료

- https://github.com/vulhub/vulhub/tree/master/langflow/CVE-2025-3248
- https://nvd.nist.gov/vuln/detail/CVE-2025-3248
- https://horizon3.ai/attack-research/disclosures/unsafe-at-any-speed-abusing-python-exec-for-unauth-rce-in-langflow-ai/?utm_source=chatgpt.com

---

GitHub 레포 링크:
[https://github.com/yoonhui/kr-vulhub/tree/main/langflow/CVE-2025-3248]
