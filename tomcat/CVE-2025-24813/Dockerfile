FROM vulhub/tomcat:9.0.97

LABEL maintainer="phithon <root@leavesongs.com>"

# Commons Collections 등 필요한 의존성 추가
ADD https://repo1.maven.org/maven2/commons-collections/commons-collections/3.2.1/commons-collections-3.2.1.jar /usr/local/tomcat/lib/
ADD https://repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.9.2/commons-beanutils-1.9.2.jar /usr/local/tomcat/lib/
ADD https://repo1.maven.org/maven2/commons-logging/commons-logging/1.1.1/commons-logging-1.1.1.jar /usr/local/tomcat/lib/

# web.xml 및 context.xml 설정 수정
RUN set -ex \
    && chmod 644 /usr/local/tomcat/lib/*.jar \
    && sed -i '/<load-on-startup>1<\/load-on-startup>/i \        <init-param>\n            <param-name>readonly</param-name>\n            <param-value>false</param-value>\n        </init-param>' /usr/local/tomcat/conf/web.xml \
    && sed -i '/<\/Context>/i \    <Manager className="org.apache.catalina.session.PersistentManager">\n        <Store className="org.apache.catalina.session.FileStore"/>\n    </Manager>' /usr/local/tomcat/conf/context.xml \
    && mkdir -p /usr/local/tomcat/work/Catalina/localhost/ROOT \
    && chmod -R 777 /usr/local/tomcat/work
