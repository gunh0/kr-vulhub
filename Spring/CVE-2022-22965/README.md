# Spring Framework Data Binding Remote Code Execution on JDK 9+ (CVE-2022-22965)

> 화이트햇 스쿨 3기 - [이호영 (@lhywk)](https://github.com/lhywk)

<br/>

### 요약

- `Spring Framework`의 `Data Binding` 기능을 악용하면, RCE가 가능함  
- 특정 HTTP 파라미터를 조작하여 공격자가 임의의 `.jsp` 웹쉘을 서버에 업로드할 수 있음  
- 업로드된 웹쉘을 통해 서버 내부 명령어 실행 및 시스템 권한 탈취 시도가 가능함  
- 해당 취약점은 `Spring Framework 5.3.17` 및 `JDK 9+` 환경에서 발생

<br/>

### 환경 구성

- `docker-compose up -d` 명령어로 테스트 환경 실행  
- `http://localhost:8080/` 접속하여 Spring 앱 정상 동작 확인

<br/>

### 취약점 재현

##### Burp Suite 요청 변조 (웹쉘 업로드)

![Burp PoC Upload](./result1.png)

- `class.module.classLoader.resources.context.parent.pipeline.first.pattern` 등의 속성을 조작하여 웹쉘 JSP 파일 생성
- JSP 경로는 `/tomcatwar.jsp`



- JSP 웹쉘이 너무 커지는 것을 방지하기 위해 로그 경로 초기화 필요
- 아래 요청을 통해 `pattern` 속성 제거:

```http
GET /?class.module.classLoader.resources.context.parent.pipeline.first.pattern=
