# CVE-2019-11043

**Confributors**
- [장종일(@akinao76)] (https://github.com/akinao76)

### 요약
- CVE-2019-11043은 웹서버와 PHP 특정 버전에서 이 둘을 연결해주는 기능인 PHP-FPM에서 발생한 원격 코드 실행 취약점이다.
- 취약점은 일반적인 NGINX 환경 구성에서 발생한다.
- 이 취약점은 PHP-FPM의 무한 루프(infinite loop) 조건과 관련이 있다. PHP-FPM에서 특정 조건을 트리거하면 서버가 무한 루프에 빠져 CPU 리소스를 소비하게 되며, 이를 이용하여 원격 코드 실행이 가능해진다.

### 환경 구성 및 실행
-  `docker compose up -d`

환경이 실행되고 나면, `http://your-ip/8080/index.php` 에서 기본 페이지를 볼 수 있다.
![](setup.png)


### 공격
취약점을 재현하기 위해 이 도구를 사용한다.  <https://github.com/neex/phuip-fpizdam>:
- `go mod init [PKG name]` 으로 Go 모듈 초기화
- 이후 `go get github.com/neex/phuip-fpizdam`으로 도구 설치
![](pocready.png)

공격을 진행하려면 `~/go/bin` 경로로 이둥하여 `./phuip-fpizdam http://localhost:8080/index.php`로 도구 실행
![](exploit.png)

### 결과 

웹쉘은 PHP-FPM 백그라운드에서 작동된다. RCE를 실행하려면 `http://your-ip:8080/index.php?a=id`로 접속하면 된다.

![](exploit2.png)

### 정리
- 이 취약점은 공격자가 PHP-FPM 서버에 원격으로 액세스하고, 악의적인 코드를 실행할 수 있는 위험한 상황을 만들게 된다. 이를 해결하기 위해 PHP-FPM 버전을 최신 버전으로 업데이트하거나, 관련된 보안 패치를 적용하여 취약점을 해결할 필요가 있다.
