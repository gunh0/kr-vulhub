Ghostscript는 Adobe Systems PostScript 및 PDF(Portable Document Format) 페이지 설명 언어용 인터프리터를 기반으로 하는 소프트웨어 제품군입니다. Ghostscript가 다른 소프트웨어(예: ImageMagick)의 종속성으로 설치되기 때문에 직접 사용하는 응용 프로그램이 없더라도 Ghostscript는 프로덕션 서버(예: /usr/local/bin/gs 또는 /usr/bin/gs)에 존재합니다. Ghostscript에서 많은 취약점이 발견되었습니다. 그 중 하나는 CVE-2018-16509(Google Project Zero의 Tavis Ormandy에 의해 발견됨)입니다. 이 취약점은 v9.24 이전의 Ghostscript에서 -dSAFER 우회를 이용하여 PostScript에서 실패한 복원(grestore)을 처리하여 임의의 명령을 실행할 수 있도록 허용하는 취약점입니다. LockSafetyParams를 비활성화하고 잘못된 액세스를 방지합니다. 이 취약점은 ImageMagick과 같은 라이브러리나 Ghotscript 래퍼(이 예에서는 PIL/Pillow)를 사용하는 프로그래밍 언어의 이미지 라이브러리를 통해 도달할 수 있습니다.
rce.jpg(실제 JPG가 아닌 특수 제작된 EPS 이미지)를 업로드하여 서버에서 touch /tmp/got_rce를 실행할 수 있습니다. 증명을 위해 docker exec [CONTAINER_ID] ls -alt /tmp를 실행할 수 있습니다. CONTAINER_ID를 얻으려면 docker 컨테이너 ls로 확인할 수 있습니다. 쉘 실행을 다른 명령으로 변경하려면 rce.jpg에서 직접 touch /tmp/got_rce를 변경하면 됩니다.
oss-security에서 Tavis Ormandy의 취약점에 대한 설명을 참고할 수 있습니다.EPSImagePlugin.py에서 PIL/Pillow의 소스 코드 Ghostscript 래퍼를 확인할 수 있습니다.다음은 app.py의 취약한 코드입니다.
