# uwsgi PHP 디렉토리 순회 취약점 (CVE-2018-7490)
## 개요
</br>

uwsgi는 WSGI/uswgi/http와 같은 프로토콜을 수행하며, 플러그인을 통해 다양한 언어를 지원하는 웹 어플리케이션 서버이다.

2.0.17 이전의 uwsgi 플러그인은 `DOCUMENT_ROOT`의 감지를 적절하게 다루지 못하며, 결과적으로 `..%2f`을 통해 `DOCUMENT_ROOT`밖의 파일을 읽거나, 실행할 수 있다.

</br>

## 환경세팅 및 취약점 구현
</br>

1. CLI에서 docker compose up -d
   
2. 로컬호스트 서버 8080서버로 접속. uwsgi-php서버 정보 페이지를 볼 수 있다.
   
3. url에 <code>/..%2f..%2f..%2f..%2f..%2fetc/passwd</code>를 붙이게 되면, 사용자 passwd 파일을 읽을 수 있게 된다.

</br>

## POC
</br>

http://localhost:8080/..%2f..%2f..%2f..%2f..%2fetc/passwd

이러한 취약점은 LFI의 일종으로, 그 자체로는 위험한 공격은 되지 않는다.

그러나, passwd 파일 탈취로 이어지는 권한 상승 공격 또는 파일 업로드 공격을 통해 시스템에 치명적으로 작용할 수 있다.

</br>

## 예방법
</br>

1. 입력 유효성 검사
   파일, 디렉토리에 대한 요청을 허용할 경우 요청된 파일명에 상위디렉토리(../), 홈디렉토리(~/)와 같은 디렉토리 순회 시퀀스나 NULL byte가 존재하는지 검증하고 제거한다.
   
2. 인덱스를 통한 파일 참조
   요청에 파일경로나 파일명을 직접 요청하도록 구현하지 않고, 특정 인덱스와 파일을 매핑하여 요청시에는 인덱스를 통해 요청되도록 구현한다.
   
3. 최소 권한 적용
   사용자 계정이 불필요한 시스템 디렉토리나 파일에 접근할 수 없도록 권한을 최소화한다.
