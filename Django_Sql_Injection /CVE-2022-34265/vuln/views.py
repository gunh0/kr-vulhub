from django.core import serializers
from django.db.models.functions import Extract, Trunc
from django.http.response import JsonResponse
from vuln.models import Experiment



def vuln_extract(request):
    payload = request.GET.get('lookup_name')
    experiments = Experiment.objects.filter(start_datetime__year=Extract('end_datetime', payload))
    return JsonResponse({"res": serializers.serialize("json", experiments)})

def vuln_trunc(request):
    payload = request.GET.get('kind')
    experiments = Experiment.objects.filter(start_datetime__date=Trunc('start_datetime', payload))
    return JsonResponse({"res": serializers.serialize("json", experiments)})
