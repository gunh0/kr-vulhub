# Nginx 파일 이름 로직 취약점（CVE-2013-4547）



### 요약

-   영향을 받는 버전 Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7
-   Nginx 정규식은 \0을 만나면 중지함.
    -   하지만 \0앞에 공백을 추가하면 Nginx가 \0을 검사하지 않음

<br/>

### 환경 구성 및 실행

-   `docker compose up -d`를 실행하여 테스트 환경을 실행
-   `http://your-ip:8070/`에 접속하여 Nginx 기본 페이지를 확인
    -   이 페이지는 실제로 8070 포트의 내용을 리버스 프록시로 전달
-   `exploit.jpg` php기능파일인데 jpg확장자를 가지는 파일 
    -   업로드된 위치/exploit.jpg.php에서 헤더값을 수정하여 php파일 실행 시킬 수 있었습니다.
 
<br/>
<img width="567" alt="image" src="https://github.com/NaraDoSeong/kr-vulhub/assets/64023668/93a44445-65f0-460f-9527-c3e99f35fa97">

- Burp Suite를 사용하여 filename = exploit.jpg에 공백을 넣음
<br/>
<img width="379" alt="image" src="https://github.com/NaraDoSeong/kr-vulhub/assets/64023668/7b5a7aa0-3084-43ce-830d-dffea2b996c2">

- exploit.jpg.php를 GET할때 g(67)와 .(2e)사이에 20 00바이트 삽입 \0문자 
<br/>

### 결과
<img width="354" alt="image" src="https://github.com/NaraDoSeong/kr-vulhub/assets/64023668/3f0ddf8b-364b-4ba4-bd74-ca5629c78b75">

<br/>


### 정리

  이 취약점은 서버에서 php파일 업로드를 제한하였을경우 jpg파일로 위장하여 php파일 업로드 후 해당 업로드 위치에서 php파일을 동작시키는 위험이 있습니다. 
  안전한 웹 서비스 운영을 위해 이러한 취약점을 패치하기 위하여 업로드 위치를 알려주어서는 안되며 해당 취약점이 패치된 최신 NginX를 사용하여야 합니다.
