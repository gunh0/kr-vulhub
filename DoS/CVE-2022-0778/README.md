# OpenSSL 무한 루프를 통한 서비스 거부(DoS) 취약점 (CVE-2022-0778)

> WHS-3기 - [주수민 (@summin02)](https://github.com/summin02)

<br/>

## 개요

OpenSSL은 컴퓨터 네트워크 상에서 통신을 보호하거나, 통신 상대방을 식별해야 하는 애플리케이션을 위한 소프트웨어 라이브러리이다.

공격자가 잘못된 타원 곡선(elliptic curve) 매개변수를 가진 인증서를 조작하여, 무한 루프를 유발할 수 있다.
인증서 파싱 과정은 서명 검증 이전에 이루어지기 때문에, 외부에서 제공된 인증서를 처리하는 모든 프로세스가 이 취약점에 의해 서비스 거부(DoS) 공격을 받을 수 있다.

<br/>

## 요약
- 잘못된 타원 곡선 매개변수를 가진 인증서를 파싱하는 과정에서 무한 루프 발생
- 해당 프로세스는 정상적인 작업을 수행하지 못하고 CPU를 소모하며 서비스 거부(DoS) 상태에 빠짐
- 이 문제는 외부 입력을 처리하는 모든 OpenSSL 사용자에게 영향을 줄 수 있음

<br/>

## 환경 구성
- 터미널에서 다음 명령어를 통해 서버를 시작합니다
```
docker compose up -d
```

<br/>

## 취약점 재현
먼저, 악성 서버를 실행해야 한다.
Golang 컴파일러가 설치되어 있지 않은 경우, Docker 이미지를 사용할 수 있다.
<br/><br/>
### 1. 악성 서버를 실행
```
악성 서버를 실행하기 위하여 터미널에 해당 명령어를 실행한다.
docker run -it --rm -p 12345:12345 yywing/cve-2022-0778 --addr 0.0.0.0:12345
```
- 악성 서버 실행 결과 예시
<img width="568" alt="Running_a_malicious_server" src="https://github.com/user-attachments/assets/67e7837e-066d-4573-8d8c-21567b0b322b" />

<br/><br/>


### 2. 컨테이너 내부에서 CPU 사용량을 모니터링
```
컨테이너 내부에서 CPU 사용량을 모니터링 하기 위하여 새로운 터미널에서 다음 명령어를 실행한다.
docker compose exec curl top
```
- CPU 사용량 모니터링 예시
<img width="562" alt="Check_CPU_usage" src="https://github.com/user-attachments/assets/bc1a40dc-6cb6-4af1-8c92-b7b2e68ff128" />

<br/><br/>


### 3. 만들어진 도커 환경에 진입
```
다음 명령어를 통해 만들어진 도커 환경에 진입한다.
docker compose exec curl bash
```
- 도커 환경진입 예시
<img width="567" alt="Trigger_container_connection" src="https://github.com/user-attachments/assets/e725eff1-de87-45a2-b1f3-2ac07ba8c511" />
<br/><br/>


### 4. 악성 서버로 접속
```
앞서 띄운 악성 서버로 접속하기 위하여 새로운 터미널에서 다음 명령어를 실행한다.
curl -k https://host.docker.internal:12345
```
- 악성 서버로 접속 예시
<img width="459" alt="Request_to_malicious_server" src="https://github.com/user-attachments/assets/c7b37f6a-a846-40bc-83b7-11528d1f8093" />
<br/><br/>


### 5. CPU 점유율 확인
- 이 시점에서, cURL은 무한 루프에 빠지게 되고 CPU 리소스를 과다 소모하게 된다.
- CPU 리소스 소모 예시
<img width="565" alt="Excessive_CPU_usage" src="https://github.com/user-attachments/assets/bd61423a-2d93-4f7f-8a35-90bc48c4a6c9" />
<br/>

<br/>


## 결과 분석
- 실습 환경에서 악성 서버에 접속하기 위해 curl -k https://host.docker.internal:12345 명령어를 실행한 결과, curl 프로세스가 정상적으로 종료되지 않고 무한 루프에 빠지는 현상을 확인했다.
- docker compose exec curl top 명령어로 컨테이너 내 시스템 상태를 모니터링한 결과, curl 프로세스가 CPU 사용률을 지속적으로 100% 가까이 점유하는 것을 확인할 수 있었다.
- 이는 OpenSSL이 잘못된 타원 곡선 매개변수를 포함한 인증서를 파싱하는 과정에서 무한 루프에 빠지는 문제 때문이며, 서비스 전체의 자원을 고갈시켜 서비스 거부(DoS) 상태를 유발할 수 있음을 명확히 보여준다.

<br/>

## 정리

- 본 PoC를 통해 OpenSSL이 외부로부터 제공받은 비정상적인 인증서를 처리할 때 무한 루프가 발생하고, 심각한 리소스 소모로 이어질 수 있다는 사실을 실질적으로 확인할 수 있었다.
- 이 취약점은 공격자가 특별히 조작된 인증서를 전달하는 것만으로도 시스템을 불안정하게 만들 수 있으므로, 보안 상 매우 치명적이다.

<br/>

## 대응 방안
- OpenSSL을 최신 버전(1.1.1n 이상 또는 3.0.2 이상) 으로 즉시 업데이트해야한다.
- 외부로부터 제공받는 인증서에 대해 추가적인 입력 검증을 수행하는 것도 권장된다.
- 서비스 운영 시, 불필요한 외부 인증서 파싱을 최소화하거나, 독립적인 샌드박스 환경에서 처리하는 방법도 고려해야한다.


<br/>

## References
- https://github.com/drago-96/CVE-2022-0778
- https://www.cnblogs.com/logchen/p/16030515.html
- https://catbro666.github.io/posts/83951100/
- https://github.com/yywing/cve-2022-0778
