# phpmyadmin 4.8.1 Remote File Inclusion Vulnerability (CVE-2018-12613)

**Contributors**

-   [손성원(@orrorrorr)](https://github.com/orrorrorr)

### 요약
- phpmyAdmin은 Directory Traversal 취약점을 이용, LFI 공격에 취약함
- index.php 코드의 target 매개 변수 검증 부분에서 urldecode()함수 실행 중 취약점 발생
- 로컬파일이 inclusion되어 중요 정보 노출


### 횐경 구성
- `docker-compose up`명령어로 환경 구축
- `http://your-ip:8080/`에 접속. index.php 확인 후, 설정해 두었던 MYSQL 계정 입력
- 정상적 로그인 확인
  
![image](https://github.com/orrorrorr/whitehat-school-vulhub/assets/145451074/dabf7f62-91e7-496f-b47f-5fe1a57afee1)


### 취약점 분석
![image](https://github.com/orrorrorr/whitehat-school-vulhub/assets/145451074/14192968-a3d0-4d0a-9f3f-210d0f141b4e)

- target인자의 존재와 필터링 확인, checkPageValidity함수에서 검증 후 include
- checkPageValidity함수에서 true를 반환 받는다면 원하는 로컬파일 include 가능
  
![image](https://github.com/orrorrorr/whitehat-school-vulhub/assets/145451074/a49411ad-1fea-426a-8441-9113049a2fad)
- $_page 변수가 선언되고 mb_substr()함수 사용, $_page변수의 값이 if문의 조건에 충족되지 않으므로 건너 뜀
- urldecode()함수에서 디코딩을 한번 더 함으로 Double Encoding 기법 사용 가능
- `%253f`를 파라미터에 입력한다면 처음 검증에서 디코딩 한 번 -> `%3f`, urldecode()함수에서 한 번 -> `?`
- 전의 mb_substr()함수와는 다르게 ?가 db_sql.php뒤에 존재함, 함수 실행 후 $_page = db_sql.php
- $whitelist에 $_page=db_sql.php 가 존재 함으로 if문 true 반환
- index.php에서 include $_REQUEST['target'] 실행


### 취약점 재현
- index.php의 소스코드 분석 후, 취약점 발견
- URL을 통해 LFI공격 시도, urldecode()함수를 이용한 URLEncoding : `%253f`
- 사용자 입력을 한 번만 디코딩하는 보안 필터 무시. `%253f` -> `%3f` -> `?` Double Encoding
```
 http://your-ip:8080/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd
```
![image](https://github.com/orrorrorr/whitehat-school-vulhub/assets/145451074/b715ded1-140e-4aa7-9a7f-753aaee1f701)

### 참고 자료
- https://steemit.com/kr/@huti/phpmyadmin-local-file-inclusion-cve-2018-12613
