import requests
import time
import statistics

# Django에 등록된 URL
GET_URL  = "http://localhost:8000/vuln/?email="
POST_URL = "http://localhost:8000/vuln/"

# 테스트 케이스 정의
tests = [
    ("GET-정상",   GET_URL + "test@example.com"),
    ("GET-악성(1e4)", GET_URL + "test@" + ("a." * 10000) + "example.com"),
]

ITER = 5

def measure_get(url):
    times = []
    for _ in range(ITER):
        t0 = time.time()
        r = requests.get(url)
        times.append(time.time() - t0)
        time.sleep(0.1)
    return r.status_code, times

def measure_post(email):
    times = []
    for _ in range(ITER):
        t0 = time.time()
        r = requests.post(POST_URL, data={"email": email})
        times.append(time.time() - t0)
        time.sleep(0.1)
    return r.status_code, times

if __name__ == "__main__":
    results = []

    # 1) GET 정상, 짧은 악성
    for name, url in tests[:2]:
        code, times = measure_get(url)
        results.append((name, code, times))

    # 2) POST로 긴 악성
    #long_email = "test@" + ("a." * 100000) + "example.com"
    #code, times = measure_post(long_email)
    #results.append(("POST-악성(1e5)", code, times))

    # 결과 출력
    print(f"{'테스트':<15}{'코드':<6}{'평균(s)':>10}{'표준편차(s)':>14}")
    print("-"*45)
    for name, code, times in results:
        mean = statistics.mean(times)
        stdev = statistics.stdev(times) if len(times)>1 else 0.0
        print(f"{name:<15}{code:<6}{mean:>10.4f}{stdev:>14.4f}")
